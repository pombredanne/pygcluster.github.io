<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyGCluster &mdash; pyGCluster 0.18.4 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.18.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pyGCluster 0.18.4 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pyGCluster 0.18.4 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyGCluster</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The class :py:class:`Cluster` is a data container</span>
<span class="sd">for ... that holds several functions to allow for</span>
<span class="sd">rapid resampling and ...</span>

<span class="sd">Example:</span>

<span class="sd">   Its structure is :</span>

<span class="sd">   &gt;&gt;&gt; overview(pyGCluster)</span>
<span class="sd">   ... {</span>
<span class="sd">   ...  &#39;Identifiers&#39; :  ( fastaID1, fastaID2, ... ),</span>
<span class="sd">   ...  &#39;Conditions&#39;  :  [  cond1, cond2, ... ],</span>
<span class="sd">   ...  &#39;Data&#39; :    {</span>
<span class="sd">   ...                  fastaID1 : {</span>
<span class="sd">   ...                                  cond1 : ( mean, sd ) , cond2 : ( mean, sd ), ...</span>
<span class="sd">   ...                              }</span>
<span class="sd">   ...                  fastaID2 : {</span>
<span class="sd">   ...                                  cond1 : ( mean, sd ) , cond2 : ( mean, sd ), ...</span>
<span class="sd">   ...                              }</span>
<span class="sd">   ...              }</span>
<span class="sd">   ...</span>
<span class="sd">   ...  &#39;Cluster 2 clusterID&#39;     :  { tuple( cluster ) : index of the row of the array holding the cluster counts, i.e. the clusterID };</span>
<span class="sd">   ...      e.g.    {</span>
<span class="sd">   ...                  ( 1, 2, 4, 12 ) : 0,</span>
<span class="sd">   ...                  ( 1, 5, 9, 19 ) : 1,</span>
<span class="sd">   ...              }</span>
<span class="sd">   ...  &#39;Distance-linkage combinations&#39;     :  [ &#39;euclidean-single&#39;, &#39;euclidean-ward&#39;, ... ],</span>
<span class="sd">   ...  &#39;Distances&#39; : [ &#39;correlation&#39;, &#39;euclidean&#39;, ... ]</span>
<span class="sd">   ...  &#39;Linkages&#39;  : [ &#39;single&#39;, &#39;ward&#39;, ... ]</span>
<span class="sd">   ...  &#39;Iterations&#39;    : int, total number of re-sampling iterations that were performed</span>
<span class="sd">   ...  &#39;Cluster counts&#39;        :  numpy.array( [</span>
<span class="sd">   ...                          [ counter_method0, counter_method1], # counters for ClusterIDs</span>
<span class="sd">   ...                          [ counter_method0, counter_method1],</span>
<span class="sd">   ...                          [ ... ],</span>
<span class="sd">                                dtype = uint32</span>
<span class="sd">   ...                   ) # Counters of ClusterIDs,</span>
<span class="sd">   ...                     # while counter_method0 belongs to self[&#39;Methods][0]</span>
<span class="sd">   ...  &#39;Working directory&#39; : string, pointing at the directory where all files are saved</span>
<span class="sd">   ... }</span>

<span class="sd">Otherwise, yes ...</span>


<span class="sd">.. warning::</span>
<span class="sd">   add the other informations, such as lookup and reverse lookup dicts</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c"># pyGCluster</span>
<span class="c">#</span>
<span class="c"># Copyright (C) D. Jaeger and C. Fufezan</span>
<span class="c">#</span>
<span class="c">#    This program is free software: you can redistribute it and/or modify</span>
<span class="c">#    it under the terms of the GNU General Public License as published by</span>
<span class="c">#    the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">#    (at your option) any later version.</span>
<span class="c">#</span>
<span class="c">#    This program is distributed in the hope that it will be useful,</span>
<span class="c">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">#    GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c">#    You should have received a copy of the GNU General Public License</span>
<span class="c">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">ddict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c"># if python3k, cPickle is implemented in pickle-library</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;since fastcluster runs only under python2k, please re-call pyGCluster with python2k.&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">else</span><span class="p">:</span> <span class="c"># 2k, explicitely import cPickle</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>

<div class="viewcode-block" id="yield_noisejected_dataset"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.yield_noisejected_dataset">[docs]</a><span class="k">def</span> <span class="nf">yield_noisejected_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generator yielding a re-sampled dataset with each iteration.</span>
<span class="sd">    A re-sampled dataset is created by re-sampling each data point </span>
<span class="sd">    from the normal distribution given by its associated mean and standard deviation value.</span>
<span class="sd">    See the example above on how to define an own noise-function (e.g. uniform noise).</span>
<span class="sd">    </span>
<span class="sd">    :param data: dictionary ( OrderedDict! ) holding the data to be re-sampled.</span>
<span class="sd">    :type data: collections.OrderedDict()</span>
<span class="sd">    :param iterations: the number of re-sampled datasets this generator will yield.</span>
<span class="sd">    :type iterations: int</span>
<span class="sd">    </span>
<span class="sd">    :rtype: none</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="c"># the check that no condition is missing in arg: data is made prior, in Cluster.__init__()</span>
    <span class="c"># this is required, because only equally shaped arrays can be clustered!</span>
    <span class="c"># otherwise, &#39;ValueError: setting an array element with a sequence.&#39;</span>
    <span class="n">Random</span>                     <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span> <span class="c"># get instance for new seed!</span>
    <span class="n">n_conditions</span>               <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
    <span class="n">simulated_dataset</span>          <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span> <span class="p">),</span> <span class="n">n_conditions</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">iterations</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">data</span> <span class="p">):</span>
            <span class="k">for</span> <span class="n">col_index</span><span class="p">,</span> <span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">data_tuple</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span>  <span class="o">=</span> <span class="n">data_tuple</span>
                <span class="n">new_ratio</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="p">)</span>
                <span class="n">simulated_dataset</span><span class="p">[</span> <span class="n">row_index</span> <span class="p">][</span> <span class="n">col_index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">new_ratio</span>
        <span class="k">yield</span> <span class="n">simulated_dataset</span>
    <span class="k">return</span>
</div>
<div class="viewcode-block" id="create_default_alphabet"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.create_default_alphabet">[docs]</a><span class="k">def</span> <span class="nf">create_default_alphabet</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the default alphabet used to save clusters in a lesser memory-intense form,</span>
<span class="sd">    i.e. string.printable.replace( &#39;,&#39;, &#39;&#39; )</span>

<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="seekAndDestry"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.seekAndDestry">[docs]</a><span class="k">def</span> <span class="nf">seekAndDestry</span><span class="p">(</span><span class="n">processes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Any multiprocesses given by processes are terminated.</span>
<span class="sd">    :param processes: list containing multiprocess.Process()</span>
<span class="sd">    :type processes: list</span>

<span class="sd">    :rtype: none</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    <span class="k">return</span>
</div>
<div class="viewcode-block" id="resampling_multiprocess"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.resampling_multiprocess">[docs]</a><span class="k">def</span> <span class="nf">resampling_multiprocess</span><span class="p">(</span>
                                <span class="n">DataQ</span>                                    <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                <span class="n">data</span>                                     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                <span class="n">iterations</span>                               <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
                                <span class="n">alphabet</span>                                 <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                <span class="n">dlc</span>                                      <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                <span class="n">min_cluster_size</span>                         <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                                <span class="n">min_cluster_freq2retain</span>                  <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
                                <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">=</span> <span class="bp">None</span>
                            <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is the function that is called for each multiprocesses that is evoked internally in pyGCluster during the re-sampling.</span>
<span class="sd">    Agglomerative hierarchical clustering is performed for each distance-linkage combination (DLC) on each of iteration datasets.</span>
<span class="sd">    Clusters from each hierarchical tree are extracted, and their counts are saved in a temporary cluster-count matrix.</span>
<span class="sd">    After iterations iterations, clusters are filtered according to min_cluster_freq2retain.</span>
<span class="sd">    These clusters, together with their respective counts among all DLCs, are returned.</span>
<span class="sd">    The return value is a list containing tuples with two elements: cluster (string) and counts ( np.array )</span>
<span class="sd">    </span>
<span class="sd">    :param DataQ: data queue which is used to pipe the re-sampling results back to pyGCluster.</span>
<span class="sd">    :type DataQ: multiprocessing.Queue()</span>
<span class="sd">    :param data: dictionary ( OrderedDict! ) holding the data to be clustered -&gt; passed through to the noise-function</span>
<span class="sd">    :type data: collections.OrderedDict()</span>
<span class="sd">    :param iterations: the number of iterations this multiprocess is going to perform.</span>
<span class="sd">    :type iterations: int</span>
<span class="sd">    :param alphabet: in order to save memory, the indices describing a cluster are converted to a specific alphabet (rather than decimal system).</span>
<span class="sd">    :type alphabet: string</span>
<span class="sd">    </span>
<span class="sd">    .. note ::</span>
<span class="sd">	the alphabet must not contain a comma (&quot;,&quot;), because cluster indices are seperated by commas.</span>
<span class="sd">	</span>
<span class="sd">    :param dlc: list of the distance-linkage combinations that are going to be evaluated.</span>
<span class="sd">    :type dlc: list</span>
<span class="sd">    :param min_cluster_size: minimum size of a cluster to be considered in the re-sampling routine (smaller clusters are discarded)</span>
<span class="sd">    :type min_cluster_size: int</span>
<span class="sd">    :param min_cluster_freq2retain: once all iterations are performed, clusters are filtered according to 50% (because typically forwarded from pyGCluster) of this threshold.</span>
<span class="sd">    :type min_cluster_freq2retain: float</span>
<span class="sd">    :param function2generate_noiseinjected_datasets: function to generate re-sampled datasets.</span>
<span class="sd">    :type function2generate_noiseinjected_datasets: function</span>
<span class="sd">      </span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="kn">import</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">as</span> <span class="nn">ssd</span>
    <span class="n">imported_from_scipy</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">fastcluster</span> <span class="kn">import</span> <span class="n">linkage</span> <span class="k">as</span> <span class="n">ahc</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">linkage</span> <span class="k">as</span> <span class="n">ahc</span>
            <span class="n">imported_from_scipy</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;You do require either &quot;fastcluster&quot; or &quot;scipy&quot;!&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">DataQ</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span> <span class="s">&#39;[ ERROR ] need a Data-Queune and a data object! Returning ...&#39;</span> <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">alphabet</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">alphabet</span> <span class="o">=</span> <span class="n">create_default_alphabet</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s">&#39;,&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alphabet</span><span class="p">,</span> <span class="s">&#39;[ ERROR ] the alphabet must not contain a comma (&quot;,&quot;)!&#39;</span>
    <span class="k">if</span> <span class="n">dlc</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dlc</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;euclidean-average&#39;</span> <span class="p">]</span>  <span class="c"># NOTE maybe better have all as default ! :)</span>
    <span class="k">if</span> <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">=</span> <span class="n">yield_noisejected_dataset</span>
    <span class="n">n_objects</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">n_dlc</span>       <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dlc</span> <span class="p">)</span>
    <span class="n">metrices</span>                       <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">combo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">dlc</span> <span class="p">]</span> <span class="p">)</span>

    <span class="c"># build lookup-dict to convert index into baseX system, given by alphabet</span>
    <span class="n">baseX</span>       <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">alphabet</span> <span class="p">)</span>
    <span class="n">index2baseX</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="s">&#39;0&#39;</span> <span class="p">}</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_objects</span> <span class="p">):</span>
        <span class="n">old_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">digits</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># modified ref: http://stackoverflow.com/questions/2267362/convert-integer-to-a-string-in-a-given-numeric-base-in-python</span>
        <span class="k">while</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">alphabet</span><span class="p">[</span> <span class="n">index</span> <span class="o">%</span> <span class="n">baseX</span> <span class="p">]</span> <span class="p">)</span>
            <span class="n">index</span> <span class="o">/=</span> <span class="n">baseX</span>
        <span class="n">digits</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">converted_index</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">digits</span> <span class="p">)</span>
        <span class="n">index2baseX</span><span class="p">[</span> <span class="n">old_index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">converted_index</span>

    <span class="c"># build initial template of &#39;clusters&#39;-dict (which is needed to extract clusters from the hierarchical tree)</span>
    <span class="n">clusters_template</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ID</span> <span class="p">:</span> <span class="p">[</span> <span class="n">index2baseX</span><span class="p">[</span> <span class="n">ID</span> <span class="p">]</span> <span class="p">]</span> <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_objects</span> <span class="p">)</span> <span class="p">}</span>
    <span class="c"># initialize temporary cluster-count matrix and the other necessary objects to fill it</span>
    <span class="n">tmpstruct_clustercount_monitor</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span>                  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">,</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
    <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span>             <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="n">dlc</span>
    <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster sieve&#39;</span> <span class="p">]</span>                   <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]</span>                   <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c"># get simulated datasets</span>
    <span class="k">for</span> <span class="n">simulated_dataset</span> <span class="ow">in</span> <span class="n">function2generate_noiseinjected_datasets</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">iterations</span> <span class="p">):</span>
        <span class="c"># calculate distance matrices:</span>
        <span class="n">metric2condenseddist</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">imported_from_scipy</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrices</span><span class="p">:</span>
                <span class="n">metric2condenseddist</span><span class="p">[</span> <span class="n">metric</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ssd</span><span class="o">.</span><span class="n">pdist</span><span class="p">(</span> <span class="n">simulated_dataset</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span> <span class="p">)</span>
        <span class="c"># perform AHC:</span>
        <span class="k">for</span> <span class="n">dlc_index</span><span class="p">,</span> <span class="n">combo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">dlc</span> <span class="p">):</span>
            <span class="n">metric</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            linkage matrix example:</span>
<span class="sd">            original data:</span>
<span class="sd">            [[1,2,3],</span>
<span class="sd">             [3,2,1],</span>
<span class="sd">             [1,3,5]]</span>

<span class="sd">            Linkage matrix representing AHC with euclidean distance and ward linkage:</span>
<span class="sd">            [[ 0.        ,  2.        ,  2.23606798,  2.        ],      CLUSTER ID 3</span>
<span class="sd">             [ 1.        ,  3.        ,  4.2031734 ,  3.        ]]      CLUSTER ID 4</span>
<span class="sd">               ^ child1     ^ child2     ^ distance   ^ cluster size</span>
<span class="sd">            Hence, element 0 and 2 were merged into cluster with ID = 3 (size = 2),</span>
<span class="sd">            then element 1 and cluster 3 are merged into the root cluster with ID = 4 (size = 3).</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c"># perform AHC</span>
            <span class="k">if</span> <span class="n">imported_from_scipy</span><span class="p">:</span>
                <span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">ahc</span><span class="p">(</span> <span class="n">simulated_dataset</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">ahc</span><span class="p">(</span> <span class="n">metric2condenseddist</span><span class="p">[</span> <span class="n">metric</span> <span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">,</span> <span class="n">preserve_input</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="c"># reconstruct clusters from the linkage matrix</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># key = clusterID, value = cluster-indices</span>
            <span class="n">clusters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">clusters_template</span> <span class="p">)</span>
            <span class="n">clusterID_linkagematrix</span> <span class="o">=</span> <span class="n">n_objects</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">childID_1</span><span class="p">,</span> <span class="n">childID_2</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">linkage_matrix</span><span class="p">:</span> 
                <span class="n">clusterID_linkagematrix</span>             <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">cluster_linkagematrix</span>               <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">clusters</span><span class="p">[</span> <span class="n">childID_1</span> <span class="p">]</span> <span class="o">+</span> <span class="n">clusters</span><span class="p">[</span> <span class="n">childID_2</span> <span class="p">]</span> <span class="p">)</span>
                <span class="n">clusters</span><span class="p">[</span> <span class="n">clusterID_linkagematrix</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cluster_linkagematrix</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster_linkagematrix</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_cluster_size</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cluster</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">cluster_linkagematrix</span> <span class="p">)</span>
                <span class="c"># insert cluster into tmpstruct_clustercount_monitor and update it:</span>
                <span class="c"># but add only if its count &gt; 1 (determined via the &#39;Cluster sieve&#39;):</span>
                <span class="n">add</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]:</span>
                    <span class="n">clusterID</span> <span class="o">=</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                    <span class="n">add</span>       <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster sieve&#39;</span> <span class="p">]:</span>
                        <span class="k">if</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">clusterID</span> <span class="o">=</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c"># KeyError: &#39;pop from an empty set&#39; = set is empty</span>
                                <span class="n">clusterID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">clusterID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span>
                        <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span> <span class="o">=</span> <span class="n">clusterID</span>
                        <span class="n">add</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster sieve&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                        <span class="n">add</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                    <span class="c"># increase count by 1</span>
                    <span class="c"># if new cluster, add 10 ** 5 new rows</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">][</span> <span class="n">dlc_index</span> <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span><span class="s">&#39;Cluster counts&#39;</span><span class="p">],</span>
                             <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">][</span> <span class="n">dlc_index</span> <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># increase count by 1</span>
            <span class="k">del</span> <span class="n">clusters</span>
        <span class="k">del</span> <span class="n">metric2condenseddist</span>
    <span class="k">del</span> <span class="n">simulated_dataset</span>

    <span class="c"># only transfer clusters equal or above 50% of &#39;min_cluster_freq2retain&#39; threshold to pyGCluster:</span>
    <span class="n">min_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">min_cluster_freq2retain</span> <span class="o">*</span> <span class="n">iterations</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="p">)</span>
    <span class="n">clusterIDs2retain</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_count</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
    <span class="n">cluster_counts_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">clusterIDs2retain</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">tmpstruct_clustercount_monitor</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">]</span>
            <span class="n">cluster_counts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">del</span> <span class="n">tmpstruct_clustercount_monitor</span>
    <span class="n">DataQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span> <span class="n">cluster_counts_list</span> <span class="p">)</span>
    <span class="k">del</span> <span class="n">cluster_counts_list</span>
    <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster">[docs]</a><span class="k">class</span> <span class="nc">Cluster</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">working_directory</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initializes pyGCluster.Cluster class</span>

<span class="sd">        :param data:</span>
<span class="sd">        :type data: dict</span>

<span class="sd">        the data dict **has** to have the following structure</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; data = {</span>
<span class="sd">        ...            Identifier1 : {</span>
<span class="sd">        ...                            condition1 :  ( mean11, sd11 ),</span>
<span class="sd">        ...                            condition2 :  ( mean12, sd12 ),</span>
<span class="sd">        ...                            condition4 :  ( mean14, sd14 ),</span>
<span class="sd">        ...             },</span>
<span class="sd">        ...            Identifier2 : {</span>
<span class="sd">        ...                            condition2 :  ( mean22, sd22 ),</span>
<span class="sd">        ...                            condition3 :  ( mean23, sd23 ),</span>
<span class="sd">        ...             },</span>
<span class="sd">        ... }</span>

<span class="sd">        .. note ::</span>
<span class="sd">           Cluster Class can be initilized empty and filled using :py:func:`merge`:</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_resampling_results</span><span class="p">()</span> <span class="c"># initializes important variables</span>
        <span class="k">if</span> <span class="n">working_directory</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">working_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span>             <span class="o">=</span> <span class="n">working_directory</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;forIOskipClustersBiggerThan&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Version&#39;</span> <span class="p">]</span>                       <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Verbosity level&#39;</span> <span class="p">]</span>               <span class="o">=</span> <span class="n">verbosity_level</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">]</span>             <span class="o">=</span> <span class="p">{}</span>   <span class="c"># will be used as dict in draw functions, i.e. ids</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span>                          <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">]</span>                       <span class="o">=</span> <span class="p">{</span>
                                        <span class="s">&#39;Params&#39;</span><span class="p">:</span>   <span class="p">{</span>   <span class="s">&#39;title&#39;</span>         <span class="p">:</span> <span class="s">&#39;pyGCluster heat map&#39;</span><span class="p">,</span>
                                                        <span class="s">&#39;font family&#39;</span>    <span class="p">:</span> <span class="s">&#39;Helvetica&#39;</span><span class="p">,</span>
                                                        <span class="s">&#39;font size&#39;</span>      <span class="p">:</span> <span class="mi">14</span> <span class="p">,</span>
                                                        <span class="s">&#39;rBox width&#39;</span>     <span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
                                                        <span class="s">&#39;rBox height&#39;</span>    <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                                                        <span class="s">&#39;left border&#39;</span>    <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                                        <span class="s">&#39;top border&#39;</span>     <span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="c"># will be adjusted depending on the labels :)</span>
                                                        <span class="s">&#39;text spacing&#39;</span>   <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                                        <span class="s">&#39;text width&#39;</span>     <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
                                                        <span class="s">&#39;separator width&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                                        <span class="s">&#39;min&#39;</span>            <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                                                        <span class="s">&#39;max&#39;</span>            <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                                                        <span class="s">&#39;legend filename&#39;</span><span class="p">:</span> <span class="s">&#39;legend.svg&#39;</span><span class="p">,</span>
                                                        <span class="s">&#39;heat map filename&#39;</span> <span class="p">:</span> <span class="s">&#39;heatmap.svg&#39;</span><span class="p">,</span>
                                                        <span class="s">&#39;default color&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
                                                        <span class="s">&#39;color gradient&#39;</span> <span class="p">:</span> <span class="s">&#39;default&#39;</span><span class="p">,</span>
                                        <span class="p">},</span>
                                        <span class="s">&#39;Color Gradients&#39;</span> <span class="p">:</span> <span class="p">{</span>
                                                    <span class="s">&#39;default&#39;</span>      <span class="p">:</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">))],</span>
                                                    <span class="s">&#39;Daniel&#39;</span>       <span class="p">:</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))],</span>
                                                    <span class="s">&#39;barplot&#39;</span>      <span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.0000001</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))],</span>
                                                    <span class="s">&#39;1337&#39;</span>         <span class="p">:</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,(</span><span class="mi">77</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">77</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="p">,(</span><span class="o">+</span><span class="mf">0.02</span><span class="p">,(</span><span class="mi">77</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">77</span><span class="p">)),</span> <span class="p">(</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="p">],</span>
                                                    <span class="s">&#39;1337_2&#39;</span>       <span class="p">:</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.40</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,(</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,(</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">)),</span> <span class="p">(</span><span class="o">+</span><span class="mf">0.40</span><span class="p">,(</span><span class="mi">40</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">40</span><span class="p">)),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span> <span class="p">]</span>
                                        <span class="p">}</span>
        <span class="p">}</span>
        <span class="c"># check if data is valid, i.e. contains a value for each condition</span>
        <span class="n">data_as_ordered_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="c"># determine number of different conditions:</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conditions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c"># discard entry if any condition is missing:</span>
                <span class="n">missing_conditions</span> <span class="o">=</span> <span class="n">conditions</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_conditions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">data</span> <span class="p">):</span>
                <span class="n">data_as_ordered_dict</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="p">):</span>
                    <span class="n">data_as_ordered_dict</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]</span>  <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span>        <span class="o">=</span> <span class="n">data_as_ordered_dict</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_data_is_log2_transformed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ WARNING ] there are NO ratios &lt; 0! Is the data log2 transformed?&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;pyGCluster initialized with {0} objects among {1} different conditions.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="Cluster.draw_heat_map"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.draw_heat_map">[docs]</a>    <span class="k">def</span> <span class="nf">draw_heat_map</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">conditions</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">additional_labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">heat_map_filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">legend_filename</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draws heatmap as svg</span>

<span class="sd">        requires data in a format like this:</span>
<span class="sd">            &gt;&gt;&gt;  data =   {</span>
<span class="sd">            ...                  fastaID1 : {</span>
<span class="sd">            ...                                  cond1 : ( mean, sd ) , cond2 : ( mean, sd ), ...</span>
<span class="sd">            ...                              }</span>
<span class="sd">            ...                  fastaID2 : {</span>
<span class="sd">            ...                                  cond1 : ( mean, sd ) , cond2 : ( mean, sd ), ...</span>
<span class="sd">            ...                              }</span>
<span class="sd">            ...  }</span>

<span class="sd">        optional and, if needed, will be extracted from data</span>
<span class="sd">                identifiers</span>
<span class="sd">                conditions</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">conditions</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">conditions</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">identifiers</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Updating self[ &#39;Additional labels&#39; ]</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">additional_labels</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">additional_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c"># self[ &#39;Additional labels&#39; ][ identifier ] += additional_labels[ identifier ]</span>
        <span class="c">#</span>
        <span class="c"># Updating min/max if required</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">maxV</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">maxV</span>
        <span class="k">if</span> <span class="n">minV</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">minV</span>
        <span class="c">#</span>
        <span class="c"># determine range id needed</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">allValues</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">allValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span> <span class="n">allValues</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="n">allValues</span> <span class="p">)</span> <span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># setting default color gradient if match is found</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">color_gradient</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color_gradient</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Color Gradients&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Do not know color gradient {0}, falling back to default&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">color_gradient</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="n">color_gradient</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;color gradient&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">color_gradient</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">heat_map_filename</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;heat map filename&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">heat_map_filename</span>
        <span class="k">if</span> <span class="n">legend_filename</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;legend filename&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">legend_filename</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;expression profile filename&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;heat map filename&#39;</span> <span class="p">]</span><span class="o">+</span><span class="s">&#39;_expP.svg&#39;</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;heat map filename&#39;</span><span class="p">,</span> <span class="s">&#39;legend filename&#39;</span><span class="p">,</span> <span class="s">&#39;expression profile filename&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s">&#39;.svg&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="n">filename</span> <span class="p">]:</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="n">filename</span> <span class="p">]</span> <span class="o">+=</span> <span class="s">&#39;.svg&#39;</span>
        <span class="c">#</span>
        <span class="c"># recalucate topBorder</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">):</span>
            <span class="n">lineHeight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">line</span> <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;font size&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">lineHeight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;top border&#39;</span> <span class="p">]:</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;top border&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">lineHeight</span>

        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="n">expProf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">,</span> <span class="s">&#39;require a list of identifiers!&#39;</span>
        <span class="c"># self._draw_heat_map_legend()</span>
        <span class="n">svgOut</span>               <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;heat map filename&#39;</span><span class="p">]</span> <span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">svgWidth</span>             <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;rBox width&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text width&#39;</span><span class="p">]</span>
        <span class="n">svgHeight</span>            <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">identifiers</span> <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;rBox height&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;top border&#39;</span><span class="p">]</span>
        <span class="n">number_of_separators</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg</span>
<span class="s">        xmlns=&quot;http://www.w3.org/2000/svg&quot;</span>
<span class="s">        version=&quot;1.1&quot;</span>
<span class="s">        preserveAspectRatio=&quot;xMinYMin meet&quot;</span>
<span class="s">        width=&quot;{0}&quot;</span>
<span class="s">        height=&quot;{1}&quot;</span>
<span class="s">        font-size=&quot;{font size}px&quot;</span>
<span class="s">        font-family=&quot;{font family}&quot;</span>
<span class="s">        fill=&quot;black&quot;</span>
<span class="s">        text-anchor=&quot;beginning&quot;</span>
<span class="s">        baseline-alignment=&quot;middle&quot;</span>
<span class="s">        &gt;</span>
<span class="s">        &lt;title&gt;{title}&lt;/title&gt;</span>
<span class="s">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">svgWidth</span><span class="p">,</span>
                <span class="n">svgHeight</span><span class="p">,</span>
                <span class="o">**</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">]</span>
            <span class="p">),</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span>
        <span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># write top legend</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">condPos</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;left border&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">condPos</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;top border&#39;</span> <span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text spacing&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span>  <span class="nb">unicode</span><span class="p">(</span>
                            <span class="s">&#39;            &lt;text x=&quot;{0}&quot; y=&quot;{1}&quot; text-anchor=&quot;left&quot; transform=&quot;rotate(-90, {0}, {1})&quot;&gt;{2}&lt;/text&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">,</span>
                            <span class="n">condition</span>
                            <span class="p">),</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                    <span class="p">),</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">rowPos</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">identifiers</span> <span class="p">):</span>
            <span class="n">adjustedRowPos</span> <span class="o">=</span> <span class="n">rowPos</span> <span class="o">-</span> <span class="n">number_of_separators</span>
            <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s">&#39;_placeholder_&#39;</span><span class="p">:</span>
                <span class="n">shapeDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HM_calcShapeAndColor</span><span class="p">(</span>
                                                        <span class="n">x</span>                    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">y</span>                    <span class="o">=</span> <span class="n">adjustedRowPos</span><span class="p">,</span>
                                                        <span class="n">ratio</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">std</span>                  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">number_of_separators</span> <span class="o">=</span> <span class="n">number_of_separators</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x1_separator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>
                <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x2_separator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span>  <span class="o">*</span> <span class="nb">len</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">))</span>
                <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">                            &lt;line x1=&quot;{x1_separator}&quot; y1=&quot;{y}&quot; x2=&quot;{x2_separator}&quot; y2=&quot;{y}&quot; style=&quot;stroke:rgb{0};stroke-width:{1}&quot;/&gt;</span>
<span class="s">                            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;default color&#39;</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;separator width&#39;</span><span class="p">],</span>
                                    <span class="o">**</span><span class="n">shapeDict</span>
                                <span class="p">),</span>
                        <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                        <span class="p">),</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span>
                <span class="p">)</span>
                <span class="n">number_of_separators</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expProf</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[]</span> <span class="p">]</span>
                <span class="k">for</span> <span class="n">conPos</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ratio</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
                        <span class="n">insertion_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">expProf</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="c"># first entry in profile</span>
                        <span class="n">expProf</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">insertion_point</span><span class="p">,</span>  <span class="n">ratio</span> <span class="o">-</span> <span class="n">std</span> <span class="p">)</span>
                        <span class="n">expProf</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">insertion_point</span><span class="p">,</span>  <span class="n">ratio</span> <span class="o">+</span> <span class="n">std</span> <span class="p">)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">ratio</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
                        <span class="n">expProf</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[]</span> <span class="p">)</span>

                    <span class="n">shapeDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HM_calcShapeAndColor</span><span class="p">(</span>
                                                            <span class="n">x</span>                    <span class="o">=</span> <span class="n">conPos</span><span class="p">,</span>
                                                            <span class="n">y</span>                    <span class="o">=</span> <span class="n">adjustedRowPos</span><span class="p">,</span>
                                                            <span class="n">ratio</span>                <span class="o">=</span> <span class="n">ratio</span><span class="p">,</span>
                                                            <span class="n">std</span>                  <span class="o">=</span> <span class="n">std</span><span class="p">,</span>
                                                            <span class="n">number_of_separators</span> <span class="o">=</span> <span class="n">number_of_separators</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            &lt;g id=&quot;rowPos{0}_conPos{1}&quot;&gt;</span>
<span class="s">                &lt;title&gt;{ratio}&amp;#177;{std}&lt;/title&gt;</span>
<span class="s">                &lt;rect x=&quot;{x}&quot; y=&quot;{y}&quot; width=&quot;{width}&quot; height=&quot;{height}&quot; style=&quot;fill:rgb({r},{g},{b});fill-opacity:0.2;stroke:white;stroke-width:1;&quot; title=&quot;{ratio}&amp;#177;{std}&quot; /&gt;</span>
<span class="s">                &lt;path d = &quot;M {x} {y} L {x_+_width} {y} L {xNew_+_widthNew} {yNew} L {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {x} {y_+_height} L {x} {y}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew_+_widthNew} {yNew_+_heightNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew_+_widthNew} {yNew_+_heightNew}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew} {yNew}&quot; style=&quot;fill:rgb({r},{g},{b}); fill-opacity:0.7; stroke:red;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">            &lt;/g&gt;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">rowPos</span><span class="p">,</span>
                                        <span class="n">conPos</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">shapeDict</span>
                                        <span class="p">),</span>
                                    <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                                    <span class="p">),</span>
                        <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span>
                    <span class="p">)</span>
                <span class="c">#</span>

                <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x_text&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">(</span><span class="n">conPos</span> <span class="o">+</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text spacing&#39;</span><span class="p">]</span>
                <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y_text&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">(</span><span class="n">adjustedRowPos</span> <span class="o">+</span> <span class="mf">0.77</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;top border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;separator width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_separators</span><span class="p">)</span>
                <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="s">&#39;{0} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">additional_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span> <span class="o">+=</span>  <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">additional_labels</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">])</span>

                <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span> <span class="o">+=</span>  <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">])</span>

                <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            &lt;g id=&quot;Text rowPos{0}_conPos{1}&quot;&gt;</span>
<span class="s">                &lt;title&gt;{ratio}&amp;#177;{std}&lt;/title&gt;</span>
<span class="s">                &lt;text xml:space=&#39;preserve&#39; x=&quot;{x_text}&quot; y=&quot;{y_text}&quot;&gt;{text}&lt;/text&gt;</span>
<span class="s">            &lt;/g&gt;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">rowPos</span><span class="p">,</span>
                                    <span class="n">conPos</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">shapeDict</span>
                                    <span class="p">),</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                                <span class="p">),</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span>
                <span class="p">)</span>

        <span class="c"># eof</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;/svg&gt;&quot;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">svgOut</span> <span class="p">)</span>
        <span class="n">svgOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># Drawing legend</span>
        <span class="c">#</span>
        <span class="n">svgLegendOut</span>         <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;legend filename&#39;</span><span class="p">]</span> <span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">svgWidth</span>             <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">conditions</span> <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;rBox width&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text width&#39;</span><span class="p">]</span>
        <span class="n">svgHeight</span>            <span class="o">=</span> <span class="mi">11</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;rBox height&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;top border&#39;</span><span class="p">]</span>
        <span class="n">number_of_separators</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;svg</span>
<span class="s">        xmlns=&quot;http://www.w3.org/2000/svg&quot;</span>
<span class="s">        version=&quot;1.1&quot;</span>
<span class="s">        preserveAspectRatio=&quot;xMinYMin meet&quot;</span>
<span class="s">        width=&quot;{0}&quot;</span>
<span class="s">        height=&quot;{1}&quot;</span>
<span class="s">        font-size=&quot;{font size}px&quot;</span>
<span class="s">        font-family=&quot;{font family}&quot;</span>
<span class="s">        fill=&quot;black&quot;</span>
<span class="s">        text-anchor=&quot;beginning&quot;</span>
<span class="s">        baseline-alignment=&quot;middle&quot;</span>
<span class="s">        &gt;</span>
<span class="s">        &lt;title&gt;Legend&lt;/title&gt;</span>
<span class="s">        &lt;text x=&quot;{2}&quot; y=&quot;{3}&quot; text-anchor=&quot;left&quot; transform=&quot;rotate(-90, {2}, {3})&quot;&gt;ratio&lt;/text&gt;</span>
<span class="s">        &lt;text x=&quot;{4}&quot; y=&quot;{3}&quot; text-anchor=&quot;left&quot; transform=&quot;rotate(-90, {4}, {3})&quot;&gt;rel. std&lt;/text&gt;</span>
<span class="s">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">svgWidth</span><span class="p">,</span>
                <span class="n">svgHeight</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;left border&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;top border&#39;</span> <span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text spacing&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;left border&#39;</span> <span class="p">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">),</span>
                <span class="o">**</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">]</span>
            <span class="p">),</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">svgLegendOut</span>
        <span class="p">)</span>
        <span class="n">positive_step_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span><span class="s">&#39;Params&#39;</span><span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">5.0</span>
        <span class="n">negative_step_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span><span class="s">&#39;Params&#39;</span><span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">5.0</span>
        <span class="n">number_of_separators</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">_</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">positive_step_size</span> <span class="o">*</span> <span class="n">_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ratio</span> <span class="o">=</span> <span class="n">negative_step_size</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">_</span>

            <span class="n">shapeDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HM_calcShapeAndColor</span><span class="p">(</span>
                        <span class="n">x</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span>       <span class="o">=</span> <span class="n">y</span><span class="p">,</span>
                        <span class="n">ratio</span>   <span class="o">=</span> <span class="n">ratio</span><span class="p">,</span>
                        <span class="n">std</span>     <span class="o">=</span> <span class="mf">0.0</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            &lt;g id=&quot;rowPos{0}_conPos{1}&quot;&gt;</span>
<span class="s">                &lt;title&gt;{ratio}&amp;#177;{std}&lt;/title&gt;</span>
<span class="s">                &lt;rect x=&quot;{x}&quot; y=&quot;{y}&quot; width=&quot;{width}&quot; height=&quot;{height}&quot; style=&quot;fill:rgb({r},{g},{b});fill-opacity:0.2;stroke:white;stroke-width:1;&quot; title=&quot;{ratio}&amp;#177;{std}&quot; /&gt;</span>
<span class="s">                &lt;path d = &quot;M {x} {y} L {x_+_width} {y} L {xNew_+_widthNew} {yNew} L {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {x} {y_+_height} L {x} {y}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew_+_widthNew} {yNew_+_heightNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew_+_widthNew} {yNew_+_heightNew}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew} {yNew}&quot; style=&quot;fill:rgb({r},{g},{b}); fill-opacity:0.7; stroke:red;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">            &lt;/g&gt;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">y</span><span class="p">,</span>
                                        <span class="mi">2</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">shapeDict</span>
                                        <span class="p">),</span>
                                    <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                                    <span class="p">),</span>
                        <span class="nb">file</span> <span class="o">=</span> <span class="n">svgLegendOut</span>
            <span class="p">)</span>

            <span class="n">std</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">shapeDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HM_calcShapeAndColor</span><span class="p">(</span>
                        <span class="n">x</span>       <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="n">y</span>       <span class="o">=</span> <span class="n">y</span><span class="p">,</span>
                        <span class="n">ratio</span>   <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="n">std</span>     <span class="o">=</span> <span class="n">std</span>
            <span class="p">)</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">147</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">147</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">147</span>
            <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            &lt;g id=&quot;rowPos{0}_conPos{1}&quot;&gt;</span>
<span class="s">                &lt;title&gt;{ratio}&amp;#177;{std}&lt;/title&gt;</span>
<span class="s">                &lt;rect x=&quot;{x}&quot; y=&quot;{y}&quot; width=&quot;{width}&quot; height=&quot;{height}&quot; style=&quot;fill:rgb({r},{g},{b});fill-opacity:0.2;stroke:white;stroke-width:1;&quot; title=&quot;{ratio}&amp;#177;{std}&quot; /&gt;</span>
<span class="s">                &lt;path d = &quot;M {x} {y} L {x_+_width} {y} L {xNew_+_widthNew} {yNew} L {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {x} {y_+_height} L {x} {y}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:grey;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew_+_widthNew} {yNew_+_heightNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew_+_widthNew} {yNew_+_heightNew}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">                &lt;path d = &quot;M {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew} {yNew}&quot; style=&quot;fill:rgb({r},{g},{b}); fill-opacity:0.7; stroke:red;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
<span class="s">            &lt;/g&gt;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">y</span><span class="p">,</span>
                                        <span class="mi">3</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">shapeDict</span>
                                        <span class="p">),</span>
                                    <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                                    <span class="p">),</span>
                        <span class="nb">file</span> <span class="o">=</span> <span class="n">svgLegendOut</span>
            <span class="p">)</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x_text_left&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text spacing&#39;</span><span class="p">]</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x_text_right&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;text spacing&#39;</span><span class="p">]</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y_text_left&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.77</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;top border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;separator width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_separators</span><span class="p">)</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;text_left&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="s">&#39;{0:3.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">ratio</span> <span class="p">)</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;text_right&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="s">&#39;{0:2.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">std</span> <span class="p">)</span>

            <span class="k">print</span><span class="p">(</span> <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">                    &lt;g id=&quot;Legend {0}&quot;&gt;</span>
<span class="s">                        &lt;title&gt;{ratio}&amp;#177;{std}&lt;/title&gt;</span>
<span class="s">                        &lt;text xml:space=&#39;preserve&#39; x=&quot;{x_text_left}&quot; y=&quot;{y_text_left}&quot;&gt;{text_left}&lt;/text&gt;</span>
<span class="s">                        &lt;text xml:space=&#39;preserve&#39; x=&quot;{x_text_right}&quot; y=&quot;{y_text_left}&quot;&gt;{text_right}&lt;/text&gt;</span>
<span class="s">                    &lt;/g&gt;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">y</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">shapeDict</span>
                                    <span class="p">),</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="s">&#39;replace&#39;</span>
                                <span class="p">),</span>
                    <span class="nb">file</span> <span class="o">=</span> <span class="n">svgLegendOut</span>
            <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;/svg&gt;&quot;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">svgLegendOut</span> <span class="p">)</span>
        <span class="n">svgLegendOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Drawing expression profile</span>
        <span class="c">#</span>
        <span class="c"># svgExpP              = codecs.open( os.path.join( self[ &#39;Working directory&#39; ], self[ &#39;Heat map&#39; ][ &#39;Params&#39; ][&#39;expression profile filename&#39;] ), &#39;w&#39;, &#39;utf-8&#39;)</span>
        <span class="c"># svgWidth             = len( conditions ) * 2 * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox width&#39; ] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;left border&#39;] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text width&#39;]</span>
        <span class="c"># svgHeight            = 11  * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;top border&#39;]</span>
        <span class="c"># number_of_separators = 0</span>
        <span class="c"># print(&quot;&quot;&quot;&lt;svg</span>
        <span class="c"># xmlns=&quot;http://www.w3.org/2000/svg&quot;</span>
        <span class="c"># version=&quot;1.1&quot;</span>
        <span class="c"># preserveAspectRatio=&quot;xMinYMin meet&quot;</span>
        <span class="c"># width=&quot;{0}&quot;</span>
        <span class="c"># height=&quot;{1}&quot;</span>
        <span class="c"># font-size=&quot;{font size}px&quot;</span>
        <span class="c"># font-family=&quot;{font family}&quot;</span>
        <span class="c"># fill=&quot;black&quot;</span>
        <span class="c"># text-anchor=&quot;beginning&quot;</span>
        <span class="c"># baseline-alignment=&quot;middle&quot;</span>
        <span class="c"># &gt;</span>
        <span class="c"># &lt;title&gt;{title}&lt;/title&gt;</span>
        <span class="c"># &quot;&quot;&quot;.format(</span>
        <span class="c">#         svgWidth,</span>
        <span class="c">#         svgHeight,</span>
        <span class="c">#         **self[ &#39;Heat map&#39;][ &#39;Params&#39; ]</span>
        <span class="c">#     ),</span>
        <span class="c"># file = svgExpP</span>
        <span class="c"># )</span>
        <span class="c"># yTop    = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] )</span>
        <span class="c"># yBottom = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] + 11 * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ])</span>
        <span class="c"># yZero   = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] + 5.5 * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ])</span>

        <span class="c"># for condPos, condition in enumerate( conditions ):</span>
        <span class="c">#     x = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;left border&#39; ]* 10 + (2 * condPos) * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] / 2.0 )</span>
        <span class="c">#     y = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] )</span>
        <span class="c">#     print(  unicode(</span>
        <span class="c">#                     &#39;            &lt;text x=&quot;{0}&quot; y=&quot;{1}&quot; text-anchor=&quot;left&quot; transform=&quot;rotate(-90, {0}, {1})&quot;&gt;{2}&lt;/text&gt;&#39;.format(</span>
        <span class="c">#                     x,</span>
        <span class="c">#                     y,</span>
        <span class="c">#                     condition</span>
        <span class="c">#                     ),</span>
        <span class="c">#             errors = &#39;replace&#39;</span>
        <span class="c">#             ),</span>
        <span class="c">#             file = svgExpP</span>
        <span class="c">#     )</span>
        <span class="c"># positive_step_size = int( math.floor( self[ &#39;Heat map&#39; ][&#39;Params&#39;][ &#39;max&#39; ] ) ) / 5.0</span>
        <span class="c"># negative_step_size = int( math.ceil( self[ &#39;Heat map&#39; ][&#39;Params&#39;][ &#39;min&#39; ] ) ) / 5.0</span>
        <span class="c"># number_of_separators = 0</span>
        <span class="c"># for y in range(0,11):</span>
        <span class="c">#     _ = 5 - y</span>
        <span class="c">#     if _ &gt;= 0:</span>
        <span class="c">#         ratio = positive_step_size * _</span>
        <span class="c">#     else:</span>
        <span class="c">#         ratio = negative_step_size * -1 * _</span>
        <span class="c">#     print( unicode(&#39;&#39;&#39;</span>
        <span class="c">#             &lt;g id=&quot;Y-axis {0}&quot;&gt;</span>
        <span class="c">#                 &lt;title&gt;{0}&lt;/title&gt;</span>
        <span class="c">#                 &lt;text xml:space=&#39;preserve&#39; text-anchor=&quot;right&quot; x=&quot;30&quot; y=&quot;{1}&quot;&gt;{0: &gt;3.2}&lt;/text&gt;</span>
        <span class="c">#                 &lt;line x1=&quot;{5}&quot; y1=&quot;{6}&quot; x2=&quot;{4}&quot; y2=&quot;{6}&quot; style=&quot;stroke:{2};stroke-width:{3}&quot;/&gt;</span>
        <span class="c">#             &lt;/g&gt;&#39;&#39;&#39;.format(</span>
        <span class="c">#                             ratio,</span>
        <span class="c">#                             int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] + (y+1) * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ]),</span>
        <span class="c">#                             &#39;grey&#39;,</span>
        <span class="c">#                             0.5,</span>
        <span class="c">#                             int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;left border&#39; ]* 10 + (len( conditions ) + 2)  * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] / 2.0 ),</span>
        <span class="c">#                             int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;left border&#39; ]* 10 + -1*                  self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] / 2.0 ),</span>
        <span class="c">#                             int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] + (y+1) * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ] / 3.0) ,</span>
        <span class="c">#                             ),</span>
        <span class="c">#                         errors = &#39;replace&#39;</span>
        <span class="c">#                         ),</span>
        <span class="c">#             file = svgExpP</span>
        <span class="c">#     )</span>


        <span class="c"># for rowPos, identifier in enumerate( identifiers ):</span>
        <span class="c">#     print( unicode(&#39;&#39;&#39;</span>
        <span class="c">#             &lt;g id=&quot;Y-axis {0}&quot;&gt;</span>
        <span class="c">#                 &lt;title&gt;o&lt;/title&gt;</span>
        <span class="c">#                 &lt;text xml:space=&#39;preserve&#39; x=&quot;30&quot; y=&quot;{1}&quot;&gt;la&lt;/text&gt;</span>
        <span class="c">#             &lt;/g&gt;&#39;&#39;&#39;.format(</span>
        <span class="c">#                             rowPos,</span>
        <span class="c">#                             int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;top border&#39; ] - self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;text spacing&#39;] + (rowPos+1) * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;rBox height&#39; ])</span>
        <span class="c">#                             ),</span>
        <span class="c">#                         errors = &#39;replace&#39;</span>
        <span class="c">#                         ),</span>
        <span class="c">#             file = svgExpP</span>
        <span class="c">#     )</span>
        <span class="c"># for rowPos, identifier in enumerate( identifiers ):</span>
        <span class="c">#     print( unicode(&#39;&#39;&#39;</span>
        <span class="c">#         &lt;g id=&quot;rowPos{0}&quot;&gt;</span>
        <span class="c">#             &lt;title&gt;{1}&lt;/title&gt;</span>
        <span class="c">#         &#39;&#39;&#39;.format( rowPos,</span>
        <span class="c">#                         identifier</span>
        <span class="c">#                         ),</span>
        <span class="c">#             errors = &#39;replace&#39;</span>
        <span class="c">#             ),</span>
        <span class="c">#         file = svgExpP</span>
        <span class="c">#         )</span>
        <span class="c">#     for conPos, condition in enumerate( conditions ):</span>
        <span class="c">#         try:</span>
        <span class="c">#             ratio, std = data[ identifier ][ condition ]</span>
        <span class="c">#             insertion_point = len( expProf[ identifier ][ -1 ] ) / 2</span>
        <span class="c">#             # first entry in profile</span>
        <span class="c">#             expProf[ identifier ][ -1 ].insert( insertion_point,  ratio - std )</span>
        <span class="c">#             expProf[ identifier ][ -1 ].insert( insertion_point,  ratio + std )</span>

        <span class="c">#             x = int(self[ &#39;Heat map&#39;][ &#39;Params&#39; ][ &#39;left border&#39; ]* 10 + (2 * condPos) * self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] + self[ &#39;Heat map&#39;][ &#39;Params&#39; ][&#39;rBox width&#39;] / 2.0 )</span>
        <span class="c">#             y =</span>
        <span class="c">#         except:</span>
        <span class="c">#             ratio, std = None, None</span>
        <span class="c">#             expProf[ identifier ].append( [] )</span>
        <span class="c"># &#39;&#39;&#39;</span>
        <span class="c"># &lt;path d = &quot;M {x} {y} L {x_+_width} {y} L {xNew_+_widthNew} {yNew} L {xNew} {yNew} L {xNew} {yNew_+_heightNew} L {x} {y_+_height} L {x} {y}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>
        <span class="c"># &lt;path d = &quot;M {xNew_+_widthNew} {yNew_+_heightNew} L {xNew} {yNew_+_heightNew} L {xNew_+_widthNew} {yNew} L {xNew_+_widthNew} {yNew_+_heightNew}&quot; style=&quot;fill:rgb({r},{g},{b});stroke:black;stroke-width:1;stroke-opacity:0.0;&quot;/&gt;</span>

        <span class="c"># &#39;&#39;&#39;</span>



        <span class="c"># print(&quot;&lt;/svg&gt;&quot;, file = svgExpP )</span>


        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_HM_calcShapeAndColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">number_of_separators</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Internal function to determine shape and color od heatmap entries</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">shapeDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;ratio&#39;</span><span class="p">]</span>                             <span class="o">=</span> <span class="n">ratio</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;std&#39;</span><span class="p">]</span>                               <span class="o">=</span> <span class="n">std</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">],</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;g&#39;</span><span class="p">],</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HM_visualizeColor</span><span class="p">(</span> <span class="n">ratio</span> <span class="p">)</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>                                 <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;left border&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span>  <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>                                 <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;top border&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span>                             <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span>
        <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span>                            <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">std</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">std</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ratio</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span> <span class="c"># or std != 0.0:</span>
            <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># ratio and sd for this entry are None, this will lead to white box</span>
                <span class="n">stdAsPercentOfRatio</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ratio</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">ratio</span> <span class="o">+=</span> <span class="mf">0.01</span>
                <span class="n">stdAsPercentOfRatio</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">std</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">ratio</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">stdAsPercentOfRatio</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">stdAsPercentOfRatio</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="c"># print(&quot;[ pyMS WARNING ] ratio {0} &amp;plusmn; std {1} !&quot;.format(ratio,std), file=sys.stderr )</span>

            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;widthNew&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stdAsPercentOfRatio</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span>  <span class="p">))</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;heightNew&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stdAsPercentOfRatio</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span> <span class="p">))</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;xNew&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>  <span class="o">+</span>  <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox width&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;widthNew&#39;</span><span class="p">]))</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;yNew&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>  <span class="o">+</span>  <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;rBox height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;heightNew&#39;</span><span class="p">]))</span>

            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>                <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;separator width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_separators</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;yNew&#39;</span><span class="p">]</span>             <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span><span class="s">&#39;separator width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_separators</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;height_half&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y_+_height&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x_+_width&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;yNew_+_heightNew&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;yNew&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;heightNew&#39;</span><span class="p">]</span>
            <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;xNew_+_widthNew&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;xNew&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">shapeDict</span><span class="p">[</span><span class="s">&#39;widthNew&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">shapeDict</span>

    <span class="k">def</span> <span class="nf">_HM_visualizeColor</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        determine color for heat map values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">##</span>
        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span><span class="p">][</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;default color&#39;</span> <span class="p">][:]</span>
        <span class="n">colorGradient</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span> <span class="s">&#39;Color Gradients&#39;</span> <span class="p">][</span>  <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;color gradient&#39;</span><span class="p">]</span>  <span class="p">]</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span><span class="s">&#39;Params&#39;</span><span class="p">][</span> <span class="s">&#39;max&#39;</span> <span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">colorGradient</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Heat map&#39;</span> <span class="p">][</span><span class="s">&#39;Params&#39;</span><span class="p">][</span> <span class="s">&#39;min&#39;</span> <span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">colorGradient</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">scaled_ratio</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">/</span> <span class="n">scaling</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span>  <span class="n">colorGradient</span><span class="p">,</span> <span class="p">(</span> <span class="n">scaled_ratio</span><span class="p">,</span> <span class="p">)</span>  <span class="p">)</span>

            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span>  <span class="n">colorGradient</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span> <span class="n">colorGradient</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span>  <span class="n">colorGradient</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># linear interpolation ... between idx-1 &amp; idx</span>
                <span class="n">dX</span> <span class="o">=</span> <span class="p">(</span> <span class="n">scaled_ratio</span> <span class="o">-</span>  <span class="n">colorGradient</span><span class="p">[</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>  <span class="n">colorGradient</span><span class="p">[</span> <span class="n">idx</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">-</span> <span class="n">colorGradient</span><span class="p">[</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">color_chanel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">d_</span> <span class="o">=</span> <span class="n">dX</span> <span class="o">*</span> <span class="p">(</span> <span class="n">colorGradient</span><span class="p">[</span> <span class="n">idx</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">][</span> <span class="n">color_chanel</span> <span class="p">]</span> <span class="o">-</span>  <span class="n">colorGradient</span><span class="p">[</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">][</span> <span class="n">color_chanel</span> <span class="p">])</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">d_</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span> <span class="p">:</span>
                        <span class="n">color</span><span class="p">[</span> <span class="n">color_chanel</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="n">colorGradient</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span> <span class="mi">1</span> <span class="p">][</span> <span class="n">color_chanel</span> <span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">color</span><span class="p">[</span> <span class="n">color_chanel</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span> <span class="n">colorGradient</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span> <span class="mi">1</span> <span class="p">][</span> <span class="n">color_chanel</span> <span class="p">]</span> <span class="o">+</span> <span class="n">d_</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">color</span>

<div class="viewcode-block" id="Cluster.delete_resampling_results"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.delete_resampling_results">[docs]</a>    <span class="k">def</span> <span class="nf">delete_resampling_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Resets all variables holding any result of the re-sampling process.</span>
<span class="sd">        This includes the convergence determination as well as the community structure.</span>
<span class="sd">        Does not delete the data that is intended to be clustered.</span>

<span class="sd">        :rtype: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span>                                     <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span>                                          <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span>                                               <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Linkages&#39;</span> <span class="p">]</span>                                                <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span>                           <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span>                                              <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">]</span>                      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - first detected at iteration&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap&#39;</span> <span class="p">]</span>                                                 <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span>                                             <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.check_if_data_is_log2_transformed"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.check_if_data_is_log2_transformed">[docs]</a>    <span class="k">def</span> <span class="nf">check_if_data_is_log2_transformed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Simply checks if any value of the data_tuples (i.e. any mean) are below zero.</span>
<span class="sd">        This indicates that the input data was lo2 transformed.</span>

<span class="sd">        :rtype: boolean</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">condition</span><span class="p">,</span> <span class="n">data_tuple</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data_tuple</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds re-sampling results of a pyGCluster instance into another one.</span>
<span class="sd">        If the clustered data differs among those two instances, the other instance is NOT added.</span>
<span class="sd">        If the distance-linkage combinations among those two instances differ, the other instance is NOT added.</span>

<span class="sd">        :param other: the pyGCluster instance that is to be added to self.</span>
<span class="sd">        :type other: pyGCluster instance</span>

<span class="sd">        :rtype: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">],</span> <span class="s">&#39;[ ERROR ] pyGCluster-instances with different clustered data cannot be merged!&#39;</span>
        <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">),</span> <span class="s">&#39;[ ERROR ] pyGCluster-instances with a different distance-linkage combinations cannot be merged!&#39;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Iterations&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">loaded_dlc_index</span><span class="p">,</span> <span class="n">dlc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">):</span>
            <span class="n">self_dlc_index</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">dlc</span> <span class="p">)</span>
            <span class="c"># merge clusters from other into self</span>
            <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cluster</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]:</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="c"># new cluster found, assign index</span>
                <span class="n">self_clusterID</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">self_clusterID</span> <span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Cluster counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">],</span>
                            <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span> <span class="c"># add rows at bottom</span>
                <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Cluster counts&#39;</span><span class="p">][</span> <span class="n">self_clusterID</span> <span class="p">][</span> <span class="n">self_dlc_index</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">][</span> <span class="n">loaded_dlc_index</span> <span class="p">]</span>
        <span class="k">return</span>

<div class="viewcode-block" id="Cluster.resample"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.resample">[docs]</a>    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">linkages</span><span class="p">,</span> <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">min_cluster_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alphabet</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force_plotting</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">min_cluster_freq2retain</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">pickle_filename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">CPUs2use</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">iter_tol</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">iter_step</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">iter_max</span><span class="o">=</span><span class="mi">250000</span><span class="p">,</span> <span class="n">iter_topP</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">iter_window</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">iter_till_the_end</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Assessment of cluster reproducibility.</span>
<span class="sd">        Creates a maximum of iter_max noise-injected datasets, which are clustered by AHC.</span>
<span class="sd">        Those are created via the function function2generate_noiseinjected_datasets (default = Gaussian distributions).</span>
<span class="sd">        The original data (= mean data) is not directly used for clustering, but immediately altered via e.g. gauss-distribution.</span>
<span class="sd">        Once either convergence is detected or iter_max iterations have been performed,</span>
<span class="sd">        the re-sampling routine stops and stores only clusters with a maximum frequency of min_cluster_freq2retain.</span>
<span class="sd">        A convergence plot is created to visually inspect convergence.</span>
<span class="sd">        The re-sampling routine is distributed to multiple threads, if CPUs2use &gt; 1.</span>

<span class="sd">        .. note ::</span>
<span class="sd">            If memory is of concern (e.g. for a large dataset, &gt; 5000 objects), CPUs2use should be kept low.</span>

<span class="sd">        :param distances: list of distance metrices, given as strings, e.g. [ &#39;correlation&#39;, &#39;euclidean&#39; ]</span>
<span class="sd">        :type distances: list</span>
<span class="sd">        :param linkages: list of distance metrices, given as strings, e.g. [ &#39;single&#39;, &#39;ward&#39; ]</span>
<span class="sd">        :type linkages: list</span>
<span class="sd">        :param function2generate_noiseinjected_datasets: function to generate noise-injected datasets. If None (default), Gaussian distributions are used.</span>
<span class="sd">        :type function2generate_noiseinjected_datasets: function</span>
<span class="sd">        :param min_cluster_size: minimum size of a cluster, so that it is included in the assessment of cluster reproducibilities. Defaults to 4.</span>
<span class="sd">        :type min_cluster_size: int</span>
<span class="sd">        :param alphabet: alphabet used to convert decimal indices to characters to save memory. Defaults to string.printable, without &#39;,&#39;</span>
<span class="sd">        :type alphabet: string</span>

<span class="sd">        .. note ::</span>
<span class="sd">            If alphabet contains &#39;,&#39;, this character is removed from alphabet, because the indices comprising a clusters are saved comma-seperated.</span>

<span class="sd">        :param force_plotting: the convergence plot is created after each iter_step iteration (otherwise only when convergence is detected). Defaults to False.</span>
<span class="sd">        :type force_plotting: boolean</span>
<span class="sd">        :param min_cluster_freq2retain: minimum frequency of a cluster (only the maximum frequency matters) it has to exhibit to be stored in pyGCluster once all iterations are finished.</span>
<span class="sd">        :type min_cluster_freq2retain: float</span>
<span class="sd">        :param CPUs2use: number of threads that are to engaged in the re-sampling routine.</span>
<span class="sd">        :type CPUs2use: int</span>
<span class="sd">        :param iter_tol:</span>
<span class="sd">        :type iter_tol: float</span>
<span class="sd">        :param iter_step:</span>
<span class="sd">        :type iter_step: int</span>
<span class="sd">        :param iter_max: maximum number of re-sampling iterations.</span>
<span class="sd">        :type iter_max: int</span>
<span class="sd">        :param iter_topP:</span>
<span class="sd">        :type iter_topP: float</span>
<span class="sd">        :param iter_window:</span>
<span class="sd">        :type iter_window: int</span>
<span class="sd">        :param iter_till_the_end: if set to True, the convergence determination is switched off; hence, re-sampling is performed until iter_max is reached.</span>
<span class="sd">        :type iter_till_the_end: boolean</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">as</span> <span class="nn">sch</span>
        <span class="kn">import</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">as</span> <span class="nn">ssd</span>
        <span class="k">if</span> <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">function2generate_noiseinjected_datasets</span> <span class="o">=</span> <span class="n">yield_noisejected_dataset</span>
        <span class="c"># determine alphabet:</span>
        <span class="k">if</span> <span class="n">alphabet</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">alphabet</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span>
        <span class="n">alphabet</span> <span class="o">=</span> <span class="n">alphabet</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span> <span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">distances</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Linkages&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">linkages</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_step&#39;</span> <span class="p">]</span>     <span class="o">=</span> <span class="n">iter_step</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_topP&#39;</span> <span class="p">]</span>     <span class="o">=</span> <span class="n">iter_topP</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_tol&#39;</span> <span class="p">]</span>      <span class="o">=</span> <span class="n">iter_tol</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_window&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="n">iter_window</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_max&#39;</span> <span class="p">]</span>      <span class="o">=</span> <span class="n">iter_max</span>
        <span class="k">if</span> <span class="n">iter_window</span> <span class="o">%</span> <span class="n">iter_step</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] iter_window = {0} is NOT a multiple of iter_step = {1}. Better re-call with a multiple of iter_step!&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_window</span><span class="p">,</span> <span class="n">iter_step</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c"># check if permission to write:</span>
        <span class="k">if</span> <span class="n">pickle_filename</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="s">&#39;tmp.txt&#39;</span> <span class="p">),</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="s">&#39;tmp.txt&#39;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] You do not have permission, or folder does not exist!</span><span class="se">\n\t</span><span class="s">results in &quot;{0}&quot; are NOT pickled!&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
                <span class="n">pickle_filename</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">pickle_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;Pickle file with the same name detected! Pickle &quot;{0}&quot; will be loaded and clustering continued ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">pickle_fullpath</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
            <span class="n">loaded</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">pickle_filename</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span> <span class="o">+</span> <span class="n">loaded</span>

        <span class="c">## create distance-linkage combinations (dlc)</span>
        <span class="c"># check if all distance metrices are valid:</span>
        <span class="n">invalid_dists</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span> <span class="nb">dir</span><span class="p">(</span> <span class="n">ssd</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_dists</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] invalid distance metrices! &quot;{0}&quot; are not in &quot;scipy.spatial.distance&quot;.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">invalid_dists</span> <span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="c"># check if all linkage methods are valid:</span>
        <span class="n">invalid_linkages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Linkages&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="n">sch</span><span class="o">.</span><span class="n">_cpy_linkage_methods</span>
        <span class="k">if</span> <span class="n">invalid_linkages</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] invalid linkage methods! &quot;{0}&quot; are not in &quot;scipy.cluster.hierarchy&quot;.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">invalid_linkages</span> <span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="c"># get all possible distance-linkage combinations:</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]:</span>
            <span class="k">for</span> <span class="n">linkage</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Linkages&#39;</span> <span class="p">]:</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">!=</span> <span class="s">&#39;euclidean&#39;</span> <span class="ow">and</span> <span class="n">linkage</span> <span class="ow">in</span> <span class="n">sch</span><span class="o">.</span><span class="n">_cpy_euclid_methods</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;{0}-{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">distance</span><span class="p">,</span> <span class="n">linkage</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">n_dlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;{0} distance-linkage combinations are evaulated.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;... those are: {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>

        <span class="c"># create tmp_struct to store the cluster counts:</span>
        <span class="n">tmpstruct_clustercounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span>         <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span>    <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]</span>          <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c"># prepare for multiprocesses:</span>
        <span class="c"># NOTE WHAT IF FOUR THREADS ARE DEFINED, BUT ONLY ONE IS AVAILABLE ?!?</span>
        <span class="k">if</span> <span class="n">CPUs2use</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CPUs2use</span> <span class="o">&gt;</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] You requested to perform re-sampling on {0} threads, but only {1} available -&gt; better re-call with &quot;CPUs2use = {1}&quot;!&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">CPUs2use</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">n_multiprocesses</span> <span class="o">=</span> <span class="n">CPUs2use</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_multiprocesses</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">DataQ</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="n">kwargs4multiprocess</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;DataQ&#39;</span> <span class="p">]</span>                      <span class="o">=</span> <span class="n">DataQ</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;data&#39;</span> <span class="p">]</span>                       <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span>                 <span class="o">=</span> <span class="n">iter_step</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;alphabet&#39;</span> <span class="p">]</span>                   <span class="o">=</span> <span class="n">alphabet</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;dlc&#39;</span> <span class="p">]</span>                        <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;min_cluster_size&#39;</span> <span class="p">]</span>           <span class="o">=</span> <span class="n">min_cluster_size</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;min_cluster_freq2retain&#39;</span> <span class="p">]</span>    <span class="o">=</span> <span class="n">min_cluster_freq2retain</span>
        <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;function2generate_noiseinjected_datasets&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">function2generate_noiseinjected_datasets</span>
        <span class="n">os</span><span class="o">.</span><span class="n">nice</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
        <span class="n">min_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">min_cluster_freq2retain</span> <span class="o">*</span> <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">min_count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[ WARNING ] params &quot;min_cluster_freq2retain&quot; = {0} and &quot;iter_step&quot; = {1}, hence min_count = {2}</span><span class="se">\n\t</span><span class="s">-&gt; huge accumulation of unstable clusters in pyGCluster!&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">min_cluster_freq2retain</span><span class="p">,</span> <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">],</span> <span class="n">min_count</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c"># check if multiprocess are valid:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;checking if multiprocesses are functioning ...&#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">,</span>  <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp_kwargs4multiprocess</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span> <span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs4multiprocess</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
            <span class="n">tmp_kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span> <span class="n">target</span> <span class="o">=</span> <span class="n">resampling_multiprocess</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">tmp_kwargs4multiprocess</span> <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">tmp_kwargs4multiprocess</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ ERROR ] Failed to launch multi-processes!&#39;</span><span class="p">,</span>  <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">seekAndDestry</span><span class="p">(</span> <span class="p">[</span> <span class="n">p</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">DataQ</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ ERROR ] Failed to collect multi-processes!&#39;</span><span class="p">,</span>  <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">seekAndDestry</span><span class="p">(</span> <span class="p">[</span> <span class="n">p</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;success!&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="c"># other stuff:</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ask2continue</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">iter_to_continue</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">converged</span><span class="p">:</span>
            <span class="c"># prevent exceeding iter_max:</span>
            <span class="k">if</span> <span class="n">iter_max</span> <span class="o">&lt;</span> <span class="n">iteration</span> <span class="o">+</span> <span class="n">n_multiprocesses</span> <span class="o">*</span> <span class="n">iter_step</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">iter_to_continue</span><span class="p">:</span>
                <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="p">(</span> <span class="n">iter_max</span> <span class="o">-</span> <span class="n">iteration</span> <span class="p">)</span> <span class="o">/</span> <span class="n">n_multiprocesses</span> <span class="p">)</span> <span class="p">)</span>
            <span class="c"># Launching multi-processes</span>
            <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_multiprocesses</span> <span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span> <span class="n">target</span> <span class="o">=</span> <span class="n">resampling_multiprocess</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs4multiprocess</span> <span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">p</span> <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="p">)</span> <span class="c"># to increase randomness!</span>

            <span class="c"># Collecting Process outputs and transfer cluster-counts into &#39;tmpstruct_clustercounts&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_multiprocesses</span> <span class="p">):</span>
                <span class="n">cluster_counts_list</span> <span class="o">=</span> <span class="n">DataQ</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">iteration</span> <span class="o">+=</span> <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&quot;Clustering. Resampling data : iteration {0: &gt;7}/{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">iter_max</span> <span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">cluster_counts_list</span><span class="p">:</span>
                    <span class="c"># get cluster ID:</span>
                    <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]:</span>
                        <span class="n">clusterID</span> <span class="o">=</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># if available, get a discarded ID and assign this ID to the cluster:</span>
                        <span class="k">if</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">clusterID</span> <span class="o">=</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c"># KeyError: &#39;pop from an empty set&#39; = set is empty</span>
                                <span class="n">clusterID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">clusterID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span>
                        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span> <span class="o">=</span> <span class="n">clusterID</span>
                    <span class="c"># update counts:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">counts</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">],</span>
                              <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">counts</span>
                <span class="c"># determine most frequent clusters:</span>
                <span class="n">min_count</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">*</span> <span class="n">iter_topP</span>
                <span class="n">mostfreqIDs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_count</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">][</span> <span class="n">iteration</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">mostfreqIDs</span> <span class="p">)</span>
                <span class="k">del</span> <span class="n">mostfreqIDs</span>
                <span class="c"># check if converged:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">iter_till_the_end</span><span class="p">:</span>
                    <span class="n">converged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check4convergence</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">converged</span> <span class="ow">or</span> <span class="n">force_plotting</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">convergence_plot</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">cluster_counts_list</span>
            <span class="c"># terminate processes:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="c"># once all processes finished iter_step clusterings, perform a purging step:</span>
            <span class="c"># discard all clusters with a maximum count of the threshold:</span>
            <span class="n">min_required_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">min_cluster_freq2retain</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span> <span class="o">*</span> <span class="n">n_multiprocesses</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Discarding {0}-count-clusters ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">min_required_count</span> <span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">max_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="c"># get max count for each cluster</span>
            <span class="n">IDs2discard</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">max_counts</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">del</span> <span class="n">max_counts</span>
            <span class="c"># reset counts:</span>
            <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">IDs2discard</span><span class="p">:</span>
                <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">ID</span> <span class="p">][</span> <span class="p">:</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># delete those clusters which were attributed the discarded clusterIDs</span>
            <span class="n">clusters2discard</span> <span class="o">=</span> <span class="p">[</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cID</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">cID</span> <span class="ow">in</span> <span class="n">IDs2discard</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters2discard</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                <span class="k">del</span> <span class="n">cluster</span>
            <span class="k">del</span> <span class="n">clusters2discard</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;{0} discarded.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">IDs2discard</span> <span class="p">)</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Discarded IDs&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">IDs2discard</span>
            <span class="k">del</span> <span class="n">IDs2discard</span>

            <span class="k">if</span> <span class="n">converged</span> <span class="ow">and</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="n">iter_max</span><span class="p">:</span>
                <span class="n">ask2continue</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">iteration</span> <span class="o">&gt;=</span> <span class="n">iter_max</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;iter_max reached. See convergence plot. Stopping re-sampling if not defined otherwise ...&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convergence_plot</span><span class="p">()</span>
                <span class="n">ask2continue</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># ask if user wants to continue with the re-sampling process:</span>
            <span class="k">if</span> <span class="n">ask2continue</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Verbosity level&#39;</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;Enter how many iterations you would like to continue. (Has to be a multiple of iterstep = {0})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_step</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;(enter &quot;0&quot; to stop resampling.)&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;(enter &quot;-1&quot; to resample until iter_max (= {0}) is reached.)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_max</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">answer</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span> <span class="s">&#39;Enter a number ...&#39;</span> <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">iter_to_continue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">answer</span> <span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;INT conversion failed. Please try again!&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">iter_to_continue</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">converged</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">iter_to_continue</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">iter_till_the_end</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iter_to_continue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">iter_step</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">iter_to_continue</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">iter_step</span><span class="p">))</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">iter_to_continue</span> <span class="o">&lt;</span> <span class="n">iter_step</span><span class="p">:</span>
                        <span class="n">iter_to_continue</span> <span class="o">=</span> <span class="n">iter_step</span>
                    <span class="n">iter_to_continue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">iter_to_continue</span> <span class="p">)</span> <span class="o">/</span> <span class="n">n_multiprocesses</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;Resampling will continue another {0} iterations.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iter_to_continue</span> <span class="o">*</span> <span class="n">n_multiprocesses</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
                    <span class="n">kwargs4multiprocess</span><span class="p">[</span> <span class="s">&#39;iterations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">iter_to_continue</span>
                    
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="c"># final filtering: store only clusters in pyGCluster whose max_frequencies are above min_cluster_freq2retain (default 0.001):</span>
        <span class="n">min_count</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">*</span> <span class="n">min_cluster_freq2retain</span>
        <span class="n">clusterIDs2retain</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_count</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;{0} clusters above threshold of {1}. &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterIDs2retain</span> <span class="p">),</span> <span class="n">min_cluster_freq2retain</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterIDs2retain</span> <span class="p">),</span> <span class="n">n_dlc</span> <span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="p">)</span>
        <span class="n">baseX</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">alphabet</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">clusterIDs2retain</span><span class="p">:</span>
                <span class="n">final_cluster</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c"># map cluster back to decimal indices:</span>
                <span class="k">for</span> <span class="n">baseXstring</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="p">):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">baseXstring</span><span class="p">[</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">):</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="n">alphabet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">digit</span> <span class="p">)</span> <span class="o">*</span> <span class="n">baseX</span> <span class="o">**</span> <span class="n">i</span>
                    <span class="n">final_cluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span>
                <span class="n">final_cluster</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">final_cluster</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="n">final_cluster</span> <span class="p">)</span>
                <span class="n">final_ID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">final_cluster</span> <span class="p">]</span> <span class="o">=</span> <span class="n">final_ID</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">final_ID</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">tmpstruct_clustercounts</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">]</span>
        <span class="c"># pickle results:</span>
        <span class="k">if</span> <span class="n">pickle_filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span> <span class="n">pickle_filename</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;re-sampling routine for {0} iterations finished. {1} clusters were obtained.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iteration</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusterIDs2retain</span><span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_get_normalized_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">iter_step</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates the normalized slope, i.e. ( y2 / y1 ) - (1.0) / iter_step,</span>
<span class="sd">        where y = amount of most frequent clusters at a certain iteration,</span>
<span class="sd">        and iter_step = x2 - x1</span>
<span class="sd">        </span>
<span class="sd">        :rtype: float        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">numerator</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>
        <span class="n">norm_slope</span>  <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">iter_step</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm_slope</span>

<div class="viewcode-block" id="Cluster.check4convergence"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.check4convergence">[docs]</a>    <span class="k">def</span> <span class="nf">check4convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks if the re-sampling routine may be terminated, because the number of most frequent clusters remains almost constant.</span>
<span class="sd">        This is done by examining a plot of the amount of most frequent clusters vs. the number of iterations.</span>
<span class="sd">        Convergence is declared once the median normalized slope in a given window of iterations is equal or below &quot;iter_tol&quot;.</span>
<span class="sd">        For further information see Supplementary Material of the corresponding publication.</span>
<span class="sd">        </span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">converged</span>          <span class="o">=</span> <span class="bp">False</span>
        <span class="n">sorted_iter2nfreqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">iter_step</span>          <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_step&#39;</span> <span class="p">]</span>
        <span class="n">iter_window</span>        <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_window&#39;</span> <span class="p">]</span>
        <span class="n">iter_tol</span>           <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_tol&#39;</span> <span class="p">]</span>
        <span class="c"># determine normalized slope:</span>
        <span class="n">norm_slopes</span>        <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">n_mostfreq</span> <span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">sorted_iter2nfreqs</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">n_mostfreq_before</span> <span class="o">=</span> <span class="n">sorted_iter2nfreqs</span><span class="p">[</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span>
            <span class="n">norm_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_normalized_slope</span><span class="p">(</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">n_mostfreq</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">n_mostfreq_before</span><span class="p">,</span> <span class="n">iter_step</span> <span class="o">=</span> <span class="n">iter_step</span> <span class="p">)</span>
            <span class="n">norm_slopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">norm_slope</span> <span class="p">)</span>
        <span class="c"># determine convergence - is the median of normalized slopes in iter_window iterations &lt;= iter_tol?</span>
        <span class="n">n_slopes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">iter_window</span> <span class="p">)</span> <span class="o">/</span> <span class="n">iter_step</span> <span class="p">)</span> <span class="p">)</span> <span class="c"># prepare for sliding window</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">norm_slopes</span> <span class="p">)</span> <span class="o">-</span> <span class="n">n_slopes</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
            <span class="n">iteration</span>                <span class="o">=</span> <span class="n">iter_step</span> <span class="o">+</span> <span class="n">iter_step</span> <span class="o">*</span> <span class="n">n_slopes</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">iter_step</span>
            <span class="n">slopes_in_sliding_window</span> <span class="o">=</span> <span class="n">norm_slopes</span><span class="p">[</span> <span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n_slopes</span> <span class="p">]</span>
            <span class="n">median_slope</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">median</span><span class="p">(</span> <span class="n">slopes_in_sliding_window</span> <span class="p">)</span>
            <span class="k">if</span> <span class="o">-</span><span class="n">iter_tol</span> <span class="o">&lt;=</span> <span class="n">median_slope</span> <span class="o">&lt;=</span> <span class="n">iter_tol</span><span class="p">:</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;potentially converged. Check convergence plot!&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - first detected at iteration&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">converged</span>
</div>
<div class="viewcode-block" id="Cluster.convergence_plot"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.convergence_plot">[docs]</a>    <span class="k">def</span> <span class="nf">convergence_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;convergence_plot.pdf&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a two-sided PDF file containing the full picture of the convergence plot, as well as a zoom of it.</span>
<span class="sd">        The convergence plot illustrated the development of the amount of most frequent clusters vs. the number of iterations.</span>
<span class="sd">        </span>
<span class="sd">        If rpy2 cannot be imported, a CSV file is created instead.</span>
<span class="sd">        </span>
<span class="sd">        :param filename: the filename of the PDF (or CSV) file.</span>
<span class="sd">        :type filename: string        </span>
<span class="sd">        </span>
<span class="sd">        :rtype: none</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">rpy2.robjects</span> <span class="kn">import</span> <span class="n">IntVector</span><span class="p">,</span> <span class="n">FloatVector</span><span class="p">,</span> <span class="n">StrVector</span>
            <span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span>
            <span class="n">graphics</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span> <span class="s">&#39;graphics&#39;</span> <span class="p">)</span>
            <span class="n">grdevices</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span> <span class="s">&#39;grDevices&#39;</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">),</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span> <span class="s">&#39;iteration,amount of most frequent clusters&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">fout</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">n_mostfreq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">print</span><span class="p">(</span> <span class="s">&#39;{0},{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">n_mostfreq</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">fout</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ WARNING ] Since rpy2 could not be imported, a CSV file instead of a PDF plot of convergence was created. See in &quot;{0}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">)</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="k">return</span>
            
        <span class="k">def</span> <span class="nf">_add_lines</span><span class="p">(</span> <span class="n">points2connect</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span> <span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">points2connect</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">x_before</span><span class="p">,</span> <span class="n">y_before</span> <span class="o">=</span> <span class="n">points2connect</span><span class="p">[</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span>
                <span class="n">graphics</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span> <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">x_before</span><span class="p">,</span> <span class="n">x</span> <span class="p">]</span> <span class="p">),</span>
                                <span class="n">FloatVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">y_before</span><span class="p">,</span> <span class="n">y</span> <span class="p">]</span> <span class="p">),</span>
                                <span class="n">lty</span> <span class="o">=</span> <span class="n">lty</span><span class="p">,</span>
                                <span class="n">col</span> <span class="o">=</span> <span class="n">color</span>
                <span class="p">)</span>

        <span class="n">iter_step</span>           <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_step&#39;</span> <span class="p">]</span>
        <span class="n">iter_window</span>         <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_window&#39;</span> <span class="p">]</span>
        <span class="n">iter_tol</span>            <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_tol&#39;</span> <span class="p">]</span>
        <span class="n">iteration2mostfreq</span>  <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span>
        <span class="n">sorted_iter2mostfreq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">iteration2mostfreq</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span>

        <span class="c"># plot convergence curve:</span>
        <span class="n">grdevices</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">12</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span> <span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="s">&#39;zoom&#39;</span> <span class="p">]:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">sorted_iter2mostfreq</span>
            <span class="n">Ys</span> <span class="o">=</span> <span class="p">[</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span> <span class="p">]</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">min</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">),</span> <span class="nb">max</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;#most_freq (left y-axis) and diff (= 1 - (current / before) / iter_step) (right y-axis)&#39;</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;zoom&#39;</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">min</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">),</span> <span class="nb">min</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">1.075</span> <span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;ZOOM&#39;</span>
            <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&#39;iter_topP = {0}, iter_step = {1}, iter_tol = {2}, iter_window = {4}, iter_max = {3}&#39;</span>
            <span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitle</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_topP&#39;</span> <span class="p">],</span>
                <span class="n">iter_step</span><span class="p">,</span>
                <span class="n">iter_tol</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_max&#39;</span> <span class="p">],</span>
                <span class="n">iter_window</span>
            <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span> <span class="p">]</span> <span class="p">),</span>
                <span class="n">IntVector</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">),</span>
                <span class="n">main</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span>
                <span class="n">sub</span>  <span class="o">=</span> <span class="n">subtitle</span><span class="p">,</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">xaxt</span> <span class="o">=</span> <span class="s">&#39;n&#39;</span><span class="p">,</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s">&#39;len(most_freq)&#39;</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">IntVector</span><span class="p">(</span> <span class="n">ylim</span> <span class="p">),</span>
                <span class="n">col</span>  <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">pch</span>  <span class="o">=</span> <span class="mi">16</span>
            <span class="p">)</span>
            <span class="n">_add_lines</span><span class="p">(</span> <span class="n">points</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span> <span class="p">)</span>
            <span class="n">x_axis_ticks</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span> <span class="n">iter_step</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span> <span class="n">iteration2mostfreq</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iter_step</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="n">IntVector</span><span class="p">(</span> <span class="n">x_axis_ticks</span> <span class="p">),</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;{0}k&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">tick</span> <span class="o">/</span> <span class="mi">1000</span> <span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">x_axis_ticks</span> <span class="p">],</span> <span class="n">las</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span> <span class="s">&#39;cex.axis&#39;</span> <span class="p">:</span> <span class="mf">0.75</span> <span class="p">}</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="n">IntVector</span><span class="p">(</span> <span class="n">x_axis_ticks</span> <span class="p">),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">StrVector</span><span class="p">(</span> <span class="p">[</span> <span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">x_axis_ticks</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="s">&#39;bottomleft&#39;</span><span class="p">,</span>
                <span class="n">legend</span> <span class="o">=</span> <span class="n">StrVector</span><span class="p">(</span> <span class="p">[</span> <span class="s">&#39;#mostfreq&#39;</span><span class="p">,</span> <span class="s">&#39;diff&#39;</span> <span class="p">]</span> <span class="p">),</span>
                <span class="n">lty</span>    <span class="o">=</span> <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">),</span>
                <span class="n">pch</span>    <span class="o">=</span> <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">),</span>
                <span class="n">bty</span>    <span class="o">=</span> <span class="s">&#39;n&#39;</span>
            <span class="p">)</span>

            <span class="c"># add second plot = normalized_slope-plot:</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">par</span><span class="p">(</span> <span class="n">new</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="n">critical_interval</span> <span class="o">=</span> <span class="p">(</span> <span class="o">-</span><span class="n">iter_tol</span><span class="p">,</span> <span class="n">iter_tol</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">firstConvergedAtIter</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - first detected at iteration&#39;</span> <span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check4convergence</span><span class="p">()</span>
                <span class="n">firstConvergedAtIter</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - first detected at iteration&#39;</span> <span class="p">]</span>
            <span class="n">iter2normslope</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="n">iter_step</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="p">)</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">n_mostfreq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">sorted_iter2mostfreq</span><span class="p">[</span> <span class="mi">1</span><span class="p">:</span> <span class="p">]</span> <span class="p">):</span>
                <span class="n">iteration_before</span><span class="p">,</span> <span class="n">n_mostfreq_before</span> <span class="o">=</span> <span class="n">sorted_iter2mostfreq</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="c"># iteration2mostfreq[ iteration - iter_step ]</span>
                <span class="n">norm_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_normalized_slope</span><span class="p">(</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">n_mostfreq</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">n_mostfreq_before</span><span class="p">,</span> <span class="n">iter_step</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">-</span> <span class="n">iteration_before</span> <span class="p">)</span>
                <span class="n">iter2normslope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">norm_slope</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">iter2normslope</span>
            <span class="n">Ys</span> <span class="o">=</span> <span class="p">[</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span> <span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span> <span class="n">critical_interval</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">critical_interval</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">points</span> <span class="p">]</span> <span class="p">),</span>
                <span class="n">FloatVector</span><span class="p">(</span> <span class="n">Ys</span> <span class="p">),</span>
                <span class="n">main</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="n">xaxt</span> <span class="o">=</span> <span class="s">&#39;n&#39;</span><span class="p">,</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="n">yaxt</span> <span class="o">=</span> <span class="s">&#39;n&#39;</span><span class="p">,</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">FloatVector</span><span class="p">(</span> <span class="n">ylim</span> <span class="p">),</span>
                <span class="n">pch</span>  <span class="o">=</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">_add_lines</span><span class="p">(</span> <span class="n">points</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">abline</span><span class="p">(</span> <span class="n">v</span> <span class="o">=</span> <span class="n">firstConvergedAtIter</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;blue&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span> <span class="n">IntVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">firstConvergedAtIter</span> <span class="o">-</span> <span class="n">iter_window</span><span class="p">,</span> <span class="n">firstConvergedAtIter</span> <span class="p">]</span> <span class="p">),</span> <span class="n">FloatVector</span><span class="p">(</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;darkgreen&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">firstConvergedAtIter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span> <span class="n">firstConvergedAtIter</span> <span class="o">/</span> <span class="mi">1000</span> <span class="p">),</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;blue&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">abline</span><span class="p">(</span> <span class="n">h</span> <span class="o">=</span> <span class="n">critical_interval</span><span class="p">[</span> <span class="mi">0</span> <span class="p">],</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;darkgreen&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">abline</span><span class="p">(</span> <span class="n">h</span> <span class="o">=</span> <span class="n">critical_interval</span><span class="p">[</span> <span class="mi">1</span> <span class="p">],</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#39;darkgreen&#39;</span> <span class="p">)</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">FloatVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">ylim</span><span class="p">[</span> <span class="mi">0</span> <span class="p">],</span> <span class="n">ylim</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">/</span> <span class="mf">20.</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">/</span> <span class="mf">20.</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">grdevices</span><span class="o">.</span><span class="n">dev_off</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;... plot of convergence finished. See plot in &quot;{0}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">)</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.plot_clusterfreqs"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.plot_clusterfreqs">[docs]</a>    <span class="k">def</span> <span class="nf">plot_clusterfreqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_clustersize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">topX_clusters</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the frequencies of each cluster as a heat map:</span>
<span class="sd">        which cluster was found by which distance-linkage combination, and with what frequency?</span>
<span class="sd">        The plot&#39;s filename is prefixed by &#39;barplot&#39;, followed by the values of the parameters.</span>
<span class="sd">        E.g. &#39;barplot_minSize4_top0clusters_top10promille.svg&#39;.</span>
<span class="sd">        Clusters are sorted by size.</span>

<span class="sd">        :param min_clustersize: only clusters with a size equal or greater than min_clustersize appear in the plot of the cluster freqs.</span>
<span class="sd">        :type min_clustersize: int</span>
<span class="sd">        :param maxfreq_threshold: Clusters must have a maximum frequency of at least maxfreq_threshold to appear in the plot.</span>
<span class="sd">        :type maxfreq_threshold: float</span>
<span class="sd">        :param topX_clusters: Plot of the top X clusters in the sorted list (by freq) of clusters having a maximum cluster frequency of at least maxfreq_threshold (clusterfreq-plot is still sorted by size).</span>
<span class="sd">        :type topX_clusters: int</span>

<span class="sd">        .. note ::</span>
<span class="sd">            if topX_clusters is set to zero ( 0 ), this filter is switched off (switched off by default).</span>

<span class="sd">        :rtype: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">allClusters_sortedByLength_l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_most_frequent_clusters</span><span class="p">(</span><span class="n">min_clustersize</span> <span class="o">=</span> <span class="n">min_clustersize</span><span class="p">,</span> <span class="n">topX_clusters</span> <span class="o">=</span> <span class="n">topX_clusters</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">=</span> <span class="n">maxfreq_threshold</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">allClusters_sortedByLength_l</span><span class="p">:</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="s">&#39;Cluster ID: {0}, size: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">],</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
            <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">dlc</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">cFreqDict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">dlc</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span> <span class="p">)</span>
                <span class="n">freqs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">frequency</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">hm_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">,</span>
            <span class="s">&#39;barplot_minSize{0}_top{1}clusters_top{2:.0f}promille.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">min_clustersize</span><span class="p">,</span> <span class="n">topX_clusters</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">maxV</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">freqs</span> <span class="p">)[</span> <span class="o">-</span><span class="mi">3</span> <span class="p">]</span> <span class="c"># since root cluster has a freq of 1.0, position -1 is always 1.0 (and -2 close to 1.0 (root, too)!)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_map</span><span class="p">(</span>
            <span class="n">identifiers</span>       <span class="o">=</span> <span class="n">identifiers</span><span class="p">,</span>
            <span class="n">data</span>              <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">conditions</span>        <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">cFreqDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span>
            <span class="n">additional_labels</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">minV</span>              <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">maxV</span>              <span class="o">=</span> <span class="n">maxV</span><span class="p">,</span>
            <span class="n">heat_map_filename</span> <span class="o">=</span> <span class="n">hm_filename</span><span class="p">,</span>
            <span class="n">legend_filename</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">color_gradient</span>    <span class="o">=</span> <span class="s">&#39;barplot&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;... clusterfreqs_heatmap saved as: &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">hm_filename</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_get_most_frequent_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_clustersize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">topX_clusters</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Gets the most frequent clusters. Filters either according to a frequency-threshold or gets the top X clusters.</span>

<span class="sd">        .. note ::</span>
<span class="sd">            Each cluster has attributed X counts, or frequencies, where X = len( Distance-linkage combinations ).</span>
<span class="sd">            For determination of most frequent clusters, only the max( X frequencies ) matters.</span>
<span class="sd">            Hence, a single frequency above maxfreq_threshold is sufficient to include that cluster.</span>

<span class="sd">        :param min_clustersize: only clusters bigger or equal than threshold are considered; e.g. 4</span>
<span class="sd">        :type data: int</span>

<span class="sd">        :param maxfreq_threshold: get all clusters with a max frequency above threshold, e.g. 0.01 =&gt; 1%-clusters</span>
<span class="sd">        :type maxfreq_threshold: float</span>

<span class="sd">        :param topX_clusters: get the top X clusters in the sorted list (by freq) of clusters having a maximum cluster frequency of at least maxfreq_threshold.</span>
<span class="sd">        :type topX_clusters: int</span>

<span class="sd">        .. note ::</span>
<span class="sd">           topX_clusters = 0 means that this filter is switched off (switched off by default).</span>

<span class="sd">        :rtype: List of the most frequent clusters in ARBITRARY order.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="n">maxfreq_threshold</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">maxfreq_threshold</span> <span class="p">)</span>
        <span class="n">topX_clusters</span>       <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">topX_clusters</span> <span class="p">)</span>

        <span class="n">topP_count</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span> <span class="o">*</span> <span class="n">maxfreq_threshold</span>


        <span class="n">most_freq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="c"># get max count for each cluster</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">topX_clusters</span><span class="p">:</span>
            <span class="n">mostfreqIDs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">max_counts</span> <span class="o">&gt;=</span> <span class="n">topP_count</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_clustersize</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">mostfreqIDs</span><span class="p">:</span>
                        <span class="n">most_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># topX_clusters filter is requested:</span>
            <span class="n">cID_mask</span> <span class="o">=</span> <span class="p">[</span> <span class="n">cID</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cID</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">c</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_clustersize</span> <span class="p">]</span>
            <span class="n">clusterIDs2retain</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cID</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">max_counts</span> <span class="o">&gt;=</span> <span class="n">topP_count</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">_</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cID</span> <span class="ow">in</span> <span class="n">cID_mask</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">clusterIDs2retain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">max_counts</span><span class="p">[</span> <span class="n">cID</span> <span class="p">],</span> <span class="n">cID</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">clusterIDs2retain</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="n">topX_clusterIDs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">cID</span> <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">cID</span> <span class="ow">in</span> <span class="n">clusterIDs2retain</span><span class="p">[</span> <span class="p">:</span> <span class="n">topX_clusters</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="n">topX_clusterIDs</span><span class="p">:</span>
                    <span class="n">most_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;{0} clusters are found for a threshold for {1} and a min cluster len of {2}.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">most_freq</span> <span class="p">),</span> <span class="n">maxfreq_threshold</span><span class="p">,</span> <span class="n">min_clustersize</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">most_freq</span>

<div class="viewcode-block" id="Cluster.plot_nodetree"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.plot_nodetree">[docs]</a>    <span class="k">def</span> <span class="nf">plot_nodetree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_filename</span> <span class="o">=</span> <span class="s">&#39;tree.dot&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        plot the dendrogram for the clustering of the most_frequent_clusters.</span>
<span class="sd">        node label = nodeID internally used for self[&#39;Nodemap&#39;] (not the same as clusterID!).</span>
<span class="sd">        edge label = distance between parent and children.</span>
<span class="sd">        edge - color codes:</span>
<span class="sd">        black   = default; highlights child which is not a most_frequent_cluster but was created during formation of the dendrogram.</span>
<span class="sd">        green   = children are connected with the root.</span>
<span class="sd">        red     = highlights child which is a most_frequent_cluster.</span>
<span class="sd">        yellow  = most_frequent_cluster is directly connected with the root.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">colors</span>           <span class="o">=</span> <span class="p">{}</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;no&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;red&#39;</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;si&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;blue&#39;</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;de&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;green&#39;</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;in&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;yellow&#39;</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;st&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="s">&#39;purple&#39;</span>
        <span class="n">colors</span><span class="p">[</span> <span class="s">&#39;ROOT&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;white&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">tree_filename</span><span class="p">),</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;digraph &quot;pyGCluster nodemap&quot; {&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
            <span class="n">node2tag</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># draw nodes:</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">]</span> <span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;-1&#39;</span>
                <span class="c"># classes = set( [ self[ &#39;Identifiers&#39; ][ i ][:2] for i in set( node ) ] )</span>
                <span class="c"># if len( set( node ) ) == self[ &#39;Root size&#39; ]:</span>
                <span class="c">#     classes = set( [ &#39;ROOT&#39; ] )</span>
                <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;size={0}, id={1}, {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span> <span class="p">),</span>
                    <span class="n">label</span><span class="p">,</span>
                    <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">classes</span> <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">classes</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span> <span class="n">classes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">node</span> <span class="p">)</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;white&#39;</span>
                <span class="k">print</span><span class="p">(</span> <span class="s">&#39;&quot;{0}&quot; [label=&quot;{1}&quot;, color = &quot;{2}&quot;];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">tag</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">fout</span> <span class="p">)</span>
                <span class="n">node2tag</span><span class="p">[</span> <span class="n">node</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
            <span class="c"># insert connecting arrows:</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">]</span> <span class="p">):</span>
                <span class="n">is_root_node</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">parent</span> <span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]:</span>
                    <span class="n">is_root_node</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">][</span> <span class="n">parent</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">][</span> <span class="n">child</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span>
                    <span class="k">if</span> <span class="n">is_root_node</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s">&#39;red&#39;</span><span class="p">:</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;yellow&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;green&#39;</span>
                    <span class="k">print</span><span class="p">(</span> <span class="s">&#39;&quot;{0}&quot; -&gt; &quot;{1}&quot; [color=&quot;{2}&quot;];&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">tag</span><span class="p">,</span> <span class="n">node2tag</span><span class="p">[</span> <span class="n">child</span> <span class="p">],</span> <span class="n">color</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">fout</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">fout</span> <span class="p">)</span>
        <span class="c"># plot tree:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_file</span>  <span class="o">=</span> <span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">tree_filename</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="s">&#39;{0}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">tree_filename</span><span class="p">[</span> <span class="p">:</span><span class="o">-</span><span class="mi">4</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span> <span class="p">[</span> <span class="s">&#39;dot&#39;</span><span class="p">,</span> <span class="s">&#39;-Tpdf&#39;</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">output_file</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ WARNING ] plotting of the binary cluster-tree failed; only DOT file created.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.calculate_distance_matrix"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.calculate_distance_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">min_overlap</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates a distance matrix</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;calculating distance matrix for {0} clusters ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusters</span> <span class="p">)</span> <span class="p">)</span> <span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="n">condensed_dist_matrix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">set</span><span class="p">(</span> <span class="n">c</span> <span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clusters</span> <span class="p">]</span>
        <span class="c"># for i, clusterI in enumerate( clusters ):</span>
        <span class="c">#     for j, clusterJ in enumerate( clusters ):</span>
        <span class="c">#         if i &lt; j:</span>
        <span class="k">for</span> <span class="n">clusterI</span><span class="p">,</span> <span class="n">clusterJ</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span> <span class="n">clusters</span><span class="p">,</span> <span class="mi">2</span> <span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterI</span> <span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterJ</span> <span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">-</span> <span class="n">b</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="n">clusterI</span> <span class="o">&amp;</span> <span class="n">clusterJ</span>
                <span class="n">n_overlap</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">overlap</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">n_sizeI</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterI</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">n_sizeJ</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">clusterJ</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">n_sizeI</span> <span class="o">&gt;</span> <span class="n">n_sizeJ</span><span class="p">:</span>
                    <span class="n">max_size</span> <span class="o">=</span> <span class="n">n_sizeI</span>
                    <span class="n">min_size</span> <span class="o">=</span> <span class="n">n_sizeJ</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_size</span> <span class="o">=</span> <span class="n">n_sizeJ</span>
                    <span class="n">min_size</span> <span class="o">=</span> <span class="n">n_sizeI</span>
                <span class="c"># if float( n_overlap ) / float( len( clusterI | clusterJ ) ) &lt; min_overlap:</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span> <span class="n">n_overlap</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">max_size</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_overlap</span><span class="p">:</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">max_size</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">n_overlap</span>
            <span class="n">condensed_dist_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dist</span> <span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - condensed distance matrix&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">condensed_dist_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;done.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span><span class="mi">2</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_get_levelX_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">cluster_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]:</span>
            <span class="n">cluster</span><span class="p">,</span> <span class="n">current_level</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">current_level</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                <span class="n">cluster_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">cluster_list</span> <span class="p">)</span>

<div class="viewcode-block" id="Cluster.build_nodemap"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.build_nodemap">[docs]</a>    <span class="k">def</span> <span class="nf">build_nodemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_clustersize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">topX_clusters</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="s">&quot;complete&quot;</span><span class="p">,</span> <span class="n">starting_min_overlap</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        input</span>

<span class="sd">        what it does</span>

<span class="sd">        output</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">as</span> <span class="nn">ssd</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">fastcluster</span> <span class="kn">import</span> <span class="n">linkage</span> <span class="k">as</span> <span class="n">ahc</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">linkage</span> <span class="k">as</span> <span class="n">ahc</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;You do require either &quot;fastcluster&quot; or &quot;scipy&quot;!&#39;</span><span class="p">)</span>

        <span class="n">min_overlap</span>                <span class="o">=</span> <span class="n">starting_min_overlap</span>
        <span class="n">last_community_snapshot</span>    <span class="o">=</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">communities_by_ahc</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">,</span> <span class="n">min_overlap</span><span class="p">):</span>
            <span class="c"># calculate distance matrix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_distance_matrix</span><span class="p">(</span> <span class="n">clusters</span> <span class="o">=</span> <span class="n">cluster_list</span><span class="p">,</span> <span class="n">min_overlap</span> <span class="o">=</span> <span class="n">min_overlap</span> <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ssd</span><span class="o">.</span><span class="n">is_valid_y</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - condensed distance matrix&#39;</span> <span class="p">]</span> <span class="p">):</span>
                <span class="k">print</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - condensed distance matrix&#39;</span> <span class="p">]</span> <span class="p">)</span>
            <span class="c"># perform AHC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;performing AHC for {0} clusters ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster_list</span> <span class="p">)</span> <span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - linkage matrix&#39;</span> <span class="p">]</span>  <span class="o">=</span> <span class="n">ahc</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - condensed distance matrix&#39;</span> <span class="p">],</span> <span class="n">method</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">,</span> <span class="n">preserve_input</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;done.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="c"># parse clusters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;parsing clusters ...&#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="n">clusters</span>    <span class="o">=</span> <span class="p">{}</span> <span class="c"># required to reconstruct the clusters from the linkage matrix</span>
            <span class="n">nodemap</span>     <span class="o">=</span> <span class="p">{}</span> <span class="c"># each node = value is a dict with two keys: &#39;parent&#39; -&gt; parent cluster (as tuple), &#39;children&#39; -&gt; set of child clusters (tuples)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">cluster_list</span> <span class="p">):</span>
                <span class="n">clusters</span><span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cluster</span>
                <span class="n">nodemap</span><span class="p">[</span> <span class="n">cluster</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;children&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;parent&#39;</span> <span class="p">:</span> <span class="bp">None</span> <span class="p">}</span>
            <span class="n">parentID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster_list</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">childID_1</span><span class="p">,</span> <span class="n">childID_2</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - linkage matrix&#39;</span> <span class="p">]:</span>
                <span class="n">parentID</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">child1</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span> <span class="n">childID_1</span> <span class="p">]</span>
                <span class="n">child2</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span> <span class="n">childID_2</span> <span class="p">]</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">child1</span> <span class="o">+</span> <span class="n">child2</span>
                <span class="n">clusters</span><span class="p">[</span> <span class="n">parentID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
                <span class="n">nodemap</span><span class="p">[</span> <span class="n">child1</span> <span class="p">][</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
                <span class="n">nodemap</span><span class="p">[</span> <span class="n">child2</span> <span class="p">][</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
                <span class="n">nodemap</span><span class="p">[</span> <span class="n">parent</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;children&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="n">child1</span><span class="p">,</span> <span class="n">child2</span> <span class="p">],</span> <span class="s">&#39;parent&#39;</span> <span class="p">:</span> <span class="bp">None</span> <span class="p">}</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">nodemap</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;done.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="c"># function 2 find communities:</span>
            <span class="k">def</span> <span class="nf">get_communities</span><span class="p">(</span> <span class="n">node</span> <span class="p">,</span> <span class="n">community_list</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">community_list</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">community_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">nodemap</span><span class="p">[</span> <span class="n">node</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]:</span>
                        <span class="n">community_list</span> <span class="o">=</span> <span class="n">get_communities</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span>  <span class="n">community_list</span> <span class="o">=</span> <span class="n">community_list</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">community_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_descendants_in_binary_tree</span><span class="p">(</span> <span class="n">node</span> <span class="o">=</span> <span class="n">child</span> <span class="p">)</span> <span class="o">+</span> <span class="p">[</span> <span class="n">child</span> <span class="p">]</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">community_list</span>

            <span class="c"># get root_node = top node of the tree:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodemap</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nodemap</span><span class="p">[</span> <span class="n">node</span> <span class="p">][</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">root_node</span> <span class="o">=</span> <span class="n">node</span>
                    <span class="k">break</span>
            <span class="n">community_list</span> <span class="o">=</span> <span class="n">get_communities</span><span class="p">(</span> <span class="n">node</span> <span class="o">=</span> <span class="n">root_node</span><span class="p">,</span> <span class="n">community_list</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">)</span>

            <span class="n">clusters_combined_into_communities</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">community_list</span><span class="p">:</span>
                <span class="n">endnodes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">community</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
                        <span class="n">endnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="n">clusters_combined_into_communities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">endnodes</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">clusters_combined_into_communities</span>

        <span class="k">def</span> <span class="nf">update_communities</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">clusters_combined_into_communities</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">clusters_combined_into_communities</span><span class="p">:</span>
                <span class="c"># find cluster with highest freq</span>
                <span class="n">community_obCoFreq2cluster_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">community_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">community</span><span class="p">:</span>
                    <span class="n">highest_obCoFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span>
                    <span class="n">community_obCoFreq2cluster_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">highest_obCoFreq</span><span class="p">,</span> <span class="n">cluster</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">community_indices</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="n">community_obCoFreq2cluster_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
                <span class="n">first_cluster</span> <span class="o">=</span> <span class="n">community_obCoFreq2cluster_list</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">community_indices</span> <span class="p">)</span> <span class="p">),</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]:</span>
                    <span class="n">current_highest_obCoFreq</span> <span class="o">=</span> <span class="n">community_obCoFreq2cluster_list</span><span class="p">[</span> <span class="mi">0</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span>
                    <span class="k">if</span> <span class="n">current_highest_obCoFreq</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]:</span>
                        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">first_cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">]</span>
                    <span class="n">community_obCoFreq2cluster_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span> <span class="c"># assure that the first cluster is also properly inserted</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">first_cluster</span> <span class="p">]</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">first_cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">first_cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">]</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;# of nodes merged into community&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">first_cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;# of nodes merged into community&#39;</span> <span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;# of nodes merged into community&#39;</span> <span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">community_obCoFreq2cluster_list</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
                <span class="c"># insert children and update obCoFreq-Dict:</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">community_obCoFreq2cluster_list</span><span class="p">[</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">]:</span>
                    <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                    <span class="n">placeholder_added</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                        <span class="n">obCoFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span>
                        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]:</span>
                            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">obCoFreq</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">placeholder_added</span><span class="p">:</span>
                                <span class="n">placeholder</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">placeholder</span> <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
                                <span class="n">placeholder_added</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">obCoFreq</span>
                <span class="n">max_freq</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">max_freq</span>

                <span class="c"># draw_heat_map(name)</span>

            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">init_cluster2community0_level</span><span class="p">():</span>
            <span class="n">most_frequent_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_most_frequent_clusters</span><span class="p">(</span> <span class="n">min_clustersize</span> <span class="o">=</span> <span class="n">min_clustersize</span><span class="p">,</span> <span class="n">topX_clusters</span> <span class="o">=</span> <span class="n">topX_clusters</span><span class="p">,</span> <span class="n">maxfreq_threshold</span> <span class="o">=</span> <span class="n">maxfreq_threshold</span> <span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">most_frequent_clusters</span> <span class="p">):</span>
                <span class="n">index2obCoFreq</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                    <span class="n">index2obCoFreq</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cFreq</span>
                <span class="n">max_freq</span> <span class="o">=</span> <span class="n">cFreq</span> <span class="c"># max_freq = max( index2obCoFreq.values() ) = cFreq, because the indices are only from a single cluster at level 0</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">]</span>                                           <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span>                             <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]</span>                <span class="o">=</span> <span class="n">index2obCoFreq</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span>                     <span class="o">=</span> <span class="n">max_freq</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">]</span>                           <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;# of nodes merged into community&#39;</span> <span class="p">]</span>     <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">return</span>

        <span class="n">init_cluster2community0_level</span><span class="p">()</span>
        <span class="n">level</span>              <span class="o">=</span> <span class="mi">0</span>
        <span class="n">community_snapshot</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">cluster_list</span>                       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_levelX_clusters</span><span class="p">(</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span> <span class="p">)</span>
            <span class="n">clusters_combined_into_communities</span> <span class="o">=</span> <span class="n">communities_by_ahc</span><span class="p">(</span> <span class="n">cluster_list</span><span class="p">,</span> <span class="n">min_overlap</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">community_snapshot</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">clusters_combined_into_communities</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">min_overlap</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_nodetree</span><span class="p">(</span> <span class="s">&#39;AHCtree_iteration{0}.dot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">update_communities</span><span class="p">(</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">,</span> <span class="n">clusters_combined_into_communities</span> <span class="o">=</span> <span class="n">clusters_combined_into_communities</span> <span class="p">)</span>
            <span class="n">community_snapshot</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">clusters_combined_into_communities</span> <span class="p">)</span>
            <span class="n">min_overlap</span>                        <span class="o">+=</span> <span class="mf">0.05</span>
            <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># update obCoFreqs -&gt; normalize by the # of nodes merged into this community</span>
        <span class="c"># (otherwise high freq clusters are hidden by large top community nodes)</span>
        <span class="c"># for name in self[ &#39;Communities&#39; ]:</span>
            <span class="c"># for index in self[ &#39;Communities&#39; ][ name ][ &#39;index 2 obCoFreq dict&#39; ]:</span>
                <span class="c"># self[ &#39;Communities&#39; ][ name ][ &#39;index 2 obCoFreq dict&#39; ][ index ] /= self[ &#39;Communities&#39; ][ name ][ &#39;# of nodes merged into community&#39; ]</span>

        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_get_descendants_in_binary_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">][</span> <span class="n">node</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Nodemap - binary tree&#39;</span> <span class="p">][</span> <span class="n">node</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_descendants_in_binary_tree</span><span class="p">(</span> <span class="n">node</span> <span class="o">=</span> <span class="n">child</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">children</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span>

    <span class="k">def</span> <span class="nf">_get_descendants_in_community_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        works</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">parent_name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">parent_name</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">parent_name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]:</span>
                <span class="n">child_name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">level</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child_name</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_descendants_in_community_tree</span><span class="p">(</span> <span class="n">parent_name</span> <span class="o">=</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">children</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span>

<div class="viewcode-block" id="Cluster.create_rainbow_colors"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.create_rainbow_colors">[docs]</a>    <span class="k">def</span> <span class="nf">create_rainbow_colors</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns list of colors as hexcodes of RGB values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">colorsys</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_colors</span> <span class="p">):</span>
            <span class="c"># i has to be [0.0, 1.0[</span>
            <span class="n">i</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">n_colors</span> <span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="p">]</span>
            <span class="n">hexcode</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rgb</span><span class="p">:</span>
                <span class="n">_hex</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_hex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_hex</span> <span class="o">=</span> <span class="s">&#39;0{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_hex</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_hex</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_hex</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="n">hexcode</span> <span class="o">+=</span> <span class="n">_hex</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hexcode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">colors</span>
</div>
<div class="viewcode-block" id="Cluster.write_legend"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.write_legend">[docs]</a>    <span class="k">def</span> <span class="nf">write_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;legend.txt&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        input</span>

<span class="sd">        description</span>

<span class="sd">        output</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># write TXT legend</span>
        <span class="c"># assign fastas to cluster ID, e.g. cluster1 fasta1\n, fastas2\n, fasta3\n ...</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">,</span> <span class="n">filename</span> <span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">legend</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="s">&quot;Frequency order:</span><span class="se">\n</span><span class="s">{0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">legend</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]:</span>
                <span class="n">cluster</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]:</span>
                    <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cFreqDict</span> <span class="o">=</span> <span class="p">{</span> <span class="bp">None</span> <span class="p">:</span> <span class="o">-</span><span class="mi">99</span> <span class="p">}</span>
                <span class="n">nodeID</span> <span class="o">=</span> <span class="s">&#39;{0}, {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">],</span> <span class="n">level</span> <span class="p">)</span>
                <span class="k">print</span><span class="p">(</span> <span class="s">&#39;label = &quot;{nodeID:0&gt;3}&quot;, size = {size:0&gt;3}, frequencies = {frequencies}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">nodeID</span> <span class="o">=</span> <span class="n">nodeID</span><span class="p">,</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">),</span>
                    <span class="n">frequencies</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="s">&#39;{0:5.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span> <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">cFreqDict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span> <span class="p">])</span>
                    <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">legend</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;forIOskipClustersBiggerThan&#39;</span> <span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                    <span class="n">addOn</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional labels&#39;</span> <span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">addOn</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">][</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span> <span class="p">]</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">addOn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">addOn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">set</span><span class="p">()):</span>
                                <span class="n">addOn</span> <span class="o">=</span> <span class="s">&quot;.oOo.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">addOn</span><span class="p">)))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">print</span><span class="p">(</span> <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\t</span><span class="s">{2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">nodeID</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">],</span> <span class="n">addOn</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">legend</span> <span class="p">)</span>
                <span class="k">print</span><span class="p">(</span> <span class="s">&#39;+&#39;</span> <span class="o">*</span> <span class="mi">50</span> <span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">legend</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;... nodemap saved in &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.write_dot"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.write_dot">[docs]</a>    <span class="k">def</span> <span class="nf">write_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="p">,</span> <span class="n">scaleByFreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">min_obCoFreq2plot</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">n_legend_nodes</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">close2root_size</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        input</span>

<span class="sd">        what it does</span>

<span class="sd">        output</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="k">if</span> <span class="n">close2root_size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">close2root_size</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span>

        <span class="c"># if filename == None:</span>
        <span class="c">#     s = &#39;nodemap_minSize{0}_top{1}_top{2:.0f}promille.dot&#39;</span>
        <span class="c">#     filename = s.format(self[&#39;Params&#39;][&#39;topClusters&#39;][&#39;minClusterSize&#39;],</span>
        <span class="c">#                         self[&#39;Params&#39;][&#39;topClusters&#39;][&#39;onlyTopXclusters&#39;],</span>
        <span class="c">#                         self[&#39;Params&#39;][&#39;topClusters&#39;][&#39;minClusterFrequency&#39;]*1000)</span>

        <span class="n">node_templateString</span> <span class="o">=</span> <span class="s">&#39;&quot;{nodeID}&quot; [label=&quot;{label}&quot;, color=&quot;{color}&quot;, shape=&quot;{shape}&quot;, width=&quot;{freq}&quot;, height=&quot;{freq}&quot;, fixedsize=true, community={community}, c_members={c_members}, metrix=&quot;{metrix}&quot;, normalized_max_obCoFreq=&quot;{normalized_max_obCoFreq}&quot;];&#39;</span>
        <span class="n">node_templateString_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">edge_templateString</span> <span class="o">=</span> <span class="s">&#39;&quot;{parent}&quot; -&gt; &quot;{child}&quot; [color=&quot;{color}&quot;, arrowsize=2.0];&#39;</span>
        <span class="n">edge_templateString_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s">&#39;Communities&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;function &quot;build_nodemap()&quot; was not called prior to call this (&quot;write_dot&quot;) function. Building default nodemap ...&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_nodemap</span><span class="p">()</span>

        <span class="c"># assign each distance metric combo a specific shape (if possible):</span>
        <span class="n">metrix2shape</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_metrices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ WARNING ] more distance metrics than shapes! All shapes equal &quot;ellipse&quot;.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;ellipse&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_metrices</span> <span class="o">**</span> <span class="n">n_metrices</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;box&#39;</span><span class="p">,</span> <span class="s">&#39;ellipse&#39;</span><span class="p">,</span> <span class="s">&#39;triangle&#39;</span><span class="p">,</span> <span class="s">&#39;diamond&#39;</span><span class="p">,</span> <span class="s">&#39;octagon&#39;</span><span class="p">,</span> <span class="s">&#39;invtriangle&#39;</span><span class="p">,</span> <span class="s">&#39;invtrapezium&#39;</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_metrices</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
            <span class="k">for</span> <span class="n">metric_combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="p">,</span> <span class="n">i</span> <span class="p">):</span>
                <span class="n">metrix2shape</span><span class="p">[</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">metric_combo</span> <span class="p">)</span> <span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;metric 2 shape:&#39;</span><span class="p">,</span> <span class="n">metrix2shape</span> <span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>

        <span class="n">sorted_obCoFreqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="p">[</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">max_obCoFreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">sorted_obCoFreqs</span><span class="p">[</span> <span class="o">-</span><span class="mi">2</span> <span class="p">]</span> <span class="p">)</span> <span class="c"># sorted_obCoFreqs[ -1 ] == root, hence max_obCoFreq would always be cFreq(root) == 2.0!</span>
        <span class="n">max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">communities_top_cluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_levelX_clusters</span><span class="p">(</span> <span class="n">level</span> <span class="o">=</span> <span class="n">max_level</span> <span class="p">)</span>
        <span class="c"># set colors:</span>
        <span class="n">communities_minus_close2root</span> <span class="o">=</span> <span class="p">[</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>  <span class="n">communities_top_cluster</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">c</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">close2root_size</span> <span class="p">]</span>
        <span class="n">community_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rainbow_colors</span><span class="p">(</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">communities_minus_close2root</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">name2community_and_color</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">communityID</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">communities_top_cluster</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">communities_minus_close2root</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">community_colors</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#BEBEBE&#39;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">max_level</span> <span class="p">)</span>
            <span class="n">communityID_color</span> <span class="o">=</span> <span class="p">(</span> <span class="n">communityID</span><span class="p">,</span> <span class="n">color</span> <span class="p">)</span>
            <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">communityID_color</span>
            <span class="k">for</span> <span class="n">child_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_descendants_in_community_tree</span><span class="p">(</span> <span class="n">parent_name</span> <span class="o">=</span> <span class="n">name</span> <span class="p">):</span>
                <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">child_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">communityID_color</span>

        <span class="c"># filter nodes by min_obCoFreq2plot, and build &#39;name2nodeID&#39;-dict:</span>
        <span class="n">name2nodeID</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">skipped_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">skipped_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root&#39;</span> <span class="p">],</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]:</span>
            <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">name2nodeID</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">min_obCoFreq2plot</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]:</span>
                <span class="n">community</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">if</span> <span class="n">max_level</span> <span class="o">&gt;</span> <span class="n">level</span><span class="p">:</span> <span class="c"># prevent that communities are lost if community freq &lt; min_obCoFreq2plot</span>
                    <span class="n">skipped_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="c"># write dot file:</span>
        <span class="n">dot_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">dot_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span>  <span class="k">as</span> <span class="n">dot</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;digraph &quot;pyGCluster nodemap&quot; {&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;graph [overlap=Prism, splines=true, ranksep=5.0, nodesep=0.75];&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;node [style=filled]&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="mf">5.</span>
            <span class="c"># draw nodes:</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">max_level</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_levelX_clusters</span><span class="p">(</span> <span class="n">level</span> <span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">skipped_nodes</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c"># draw heat map:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">close2root_size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_map_for_community_cluster</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="n">maxV</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="n">color_gradient</span> <span class="p">,</span> <span class="n">sub_folder</span> <span class="o">=</span> <span class="s">&#39;communityClusters&#39;</span><span class="p">)</span>

                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;nodeID&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                    <span class="c"># scale node size:</span>
                    <span class="k">if</span> <span class="n">scaleByFreq</span><span class="p">:</span>
                        <span class="n">normalized_obCoFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span>
                        <span class="n">width</span> <span class="o">=</span> <span class="n">normalized_obCoFreq</span> <span class="o">/</span> <span class="n">max_obCoFreq</span> <span class="o">*</span> <span class="n">scale_factor</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">width</span> <span class="o">=</span> <span class="mf">2.5</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;freq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;label&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{0}-{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">],</span> <span class="n">level</span> <span class="p">)</span>
                    <span class="c"># determine shape:</span>
                    <span class="k">if</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]:</span>
                        <span class="n">clusterID</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
                        <span class="n">distances</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">]:</span>
                            <span class="n">distance</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">][</span> <span class="n">i</span> <span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)</span>
                            <span class="n">distances</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">distance</span> <span class="p">)</span>
                        <span class="n">distances</span> <span class="o">=</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">distances</span> <span class="p">)</span> <span class="p">)</span>
                        <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;metrix&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">distances</span>
                        <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;shape&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">metrix2shape</span><span class="p">[</span> <span class="n">distances</span> <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">node_templateString_dict</span><span class="p">[</span><span class="s">&#39; metrix&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span>
                        <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;shape&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;point&#39;</span>
                    <span class="c"># store the cluster&#39;s size (in terms of objects describing it), set color and community ID:</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;c_members&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                    <span class="n">communityID</span><span class="p">,</span> <span class="n">community_color</span> <span class="o">=</span> <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;color&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">community_color</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;community&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">communityID</span>
                    <span class="n">node_templateString_dict</span><span class="p">[</span> <span class="s">&#39;normalized_max_obCoFreq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;highest obCoFreq&#39;</span> <span class="p">]</span>
                    <span class="c"># finally insert node into dot-file:</span>
                    <span class="k">print</span><span class="p">(</span> <span class="n">node_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">node_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>
            <span class="c"># insert edges:</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_level</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_levelX_clusters</span><span class="p">(</span> <span class="n">level</span> <span class="p">):</span>
                    <span class="n">parent_name</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">parent</span><span class="p">,</span> <span class="n">level</span> <span class="p">)</span>
                    <span class="n">edge_templateString_dict</span><span class="p">[</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">parent_name</span> <span class="p">]</span>
                    <span class="n">edge_templateString_dict</span><span class="p">[</span> <span class="s">&#39;color&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">parent_name</span> <span class="p">][</span> <span class="mi">1</span> <span class="p">]</span>
                    <span class="c"># if parent_name in skipped_nodes:</span>
                    <span class="c">#     continue</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">parent_name</span> <span class="p">][</span> <span class="s">&#39;children&#39;</span> <span class="p">]:</span>
                        <span class="n">child_name</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">level</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
                        <span class="k">if</span> <span class="n">child_name</span> <span class="ow">in</span> <span class="n">skipped_nodes</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">edge_templateString_dict</span><span class="p">[</span> <span class="s">&#39;child&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">child_name</span> <span class="p">]</span>
                        <span class="c"># nut to break: child without direct parent ...</span>
                        <span class="k">if</span> <span class="n">parent_name</span> <span class="ow">in</span> <span class="n">skipped_nodes</span><span class="p">:</span>
                            <span class="c"># find largest parent:</span>
                            <span class="n">communityID</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">child_name</span> <span class="p">]</span>
                            <span class="c"># get all community clusters which are attributed the current communityID:</span>
                            <span class="n">community_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name2community_and_color</span><span class="p">:</span>
                                <span class="n">ID</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">name2community_and_color</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                                <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="n">communityID</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">child_name</span> <span class="ow">and</span> <span class="n">name</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">&gt;</span> <span class="n">child_name</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]:</span>
                                    <span class="n">community_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                            <span class="c"># Of those, extract clusters which are NOT to be skipped:</span>
                            <span class="n">potential_parents</span> <span class="o">=</span> <span class="n">community_names</span> <span class="o">-</span> <span class="n">skipped_nodes</span>
                            <span class="c"># get parent with lowest level:</span>
                            <span class="n">min_level</span> <span class="o">=</span> <span class="n">max_level</span>
                            <span class="k">for</span> <span class="n">potential_parent_name</span> <span class="ow">in</span> <span class="n">potential_parents</span><span class="p">:</span>
                                <span class="n">parent</span><span class="p">,</span> <span class="n">_level</span> <span class="o">=</span> <span class="n">potential_parent_name</span>
                                <span class="k">if</span> <span class="n">min_level</span> <span class="o">&gt;</span> <span class="n">_level</span><span class="p">:</span>
                                    <span class="n">min_level</span> <span class="o">=</span> <span class="n">_level</span>
                            <span class="k">for</span> <span class="n">potential_parent_name</span> <span class="ow">in</span> <span class="n">potential_parents</span><span class="p">:</span>
                                <span class="n">parent</span><span class="p">,</span> <span class="n">_level</span> <span class="o">=</span> <span class="n">potential_parent_name</span>
                                <span class="k">if</span> <span class="n">_level</span> <span class="o">==</span> <span class="n">min_level</span><span class="p">:</span>
                                    <span class="n">edge_templateString_dict</span><span class="p">[</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">potential_parent_name</span> <span class="p">]</span>
                                    <span class="k">break</span>
                        <span class="k">print</span><span class="p">(</span> <span class="n">edge_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">edge_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>

            <span class="c">## connect largest cluster of each community with root:</span>
            <span class="n">root_name</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root&#39;</span> <span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
            <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">root_name</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">name2nodeID</span> <span class="p">)</span>
            <span class="n">node_templateString_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;nodeID&#39;</span> <span class="p">:</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">root_name</span> <span class="p">],</span>
                <span class="s">&#39;freq&#39;</span> <span class="p">:</span> <span class="n">scale_factor</span><span class="p">,</span>
                <span class="s">&#39;label&#39;</span> <span class="p">:</span> <span class="s">&#39;ROOT&#39;</span><span class="p">,</span>
                <span class="s">&#39;c_members&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">],</span>
                <span class="s">&#39;community&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="s">&#39;#FFFFFF&#39;</span><span class="p">,</span>
                <span class="s">&#39;metrix&#39;</span> <span class="p">:</span> <span class="s">&#39;ALL&#39;</span><span class="p">,</span>
                <span class="s">&#39;shape&#39;</span> <span class="p">:</span> <span class="s">&#39;ellipse&#39;</span><span class="p">,</span>
                <span class="s">&#39;normalized_max_obCoFreq&#39;</span> <span class="p">:</span> <span class="s">&#39;-99&#39;</span>
            <span class="p">}</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">node_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">node_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>
            <span class="n">edge_templateString_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;parent&#39;</span> <span class="p">:</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">root_name</span> <span class="p">],</span> <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="s">&#39;#000000&#39;</span> <span class="p">}</span>
            <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">communities_top_cluster</span><span class="p">:</span>
                <span class="n">cluster_name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">max_level</span> <span class="p">)</span>
                <span class="n">edge_templateString_dict</span><span class="p">[</span> <span class="s">&#39;child&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">name2nodeID</span><span class="p">[</span> <span class="n">cluster_name</span> <span class="p">]</span>
                <span class="k">print</span><span class="p">(</span> <span class="n">edge_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">edge_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>

            <span class="c"># add legend for the node size as additional, grey, nodes:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_legend_nodes</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span>  <span class="n">max_obCoFreq</span> <span class="o">*</span> <span class="p">(</span> <span class="n">i</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">n_legend_nodes</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">max_obCoFreq</span>
                <span class="n">node_templateString_dict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;nodeID&#39;</span> <span class="p">:</span> <span class="s">&#39;legend_node_{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">i</span> <span class="p">),</span>
                    <span class="s">&#39;freq&#39;</span> <span class="p">:</span> <span class="n">f</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span>
                    <span class="s">&#39;label&#39;</span> <span class="p">:</span> <span class="nb">round</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="mi">4</span> <span class="p">),</span>
                    <span class="s">&#39;c_members&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;community&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="s">&#39;#BEBEBE&#39;</span><span class="p">,</span>
                    <span class="s">&#39;metrix&#39;</span> <span class="p">:</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                    <span class="s">&#39;shape&#39;</span> <span class="p">:</span> <span class="s">&#39;box&#39;</span><span class="p">,</span>
                    <span class="s">&#39;normalized_max_obCoFreq&#39;</span> <span class="p">:</span> <span class="s">&#39;-99&#39;</span>
                <span class="p">}</span>
                <span class="k">print</span><span class="p">(</span> <span class="n">node_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">node_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_legend_nodes</span> <span class="p">):</span>
                <span class="n">edge_templateString_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;parent&#39;</span> <span class="p">:</span> <span class="s">&#39;legend_node_{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">i</span> <span class="p">),</span> <span class="s">&#39;child&#39;</span> <span class="p">:</span> <span class="s">&#39;legend_node_{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">),</span> <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="s">&#39;#BEBEBE&#39;</span> <span class="p">}</span>
                <span class="k">print</span><span class="p">(</span> <span class="n">edge_templateString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="o">**</span><span class="n">edge_templateString_dict</span> <span class="p">),</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>

            <span class="k">print</span><span class="p">(</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">dot</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_legend</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;{0}__legend.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rendered_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="s">&#39;{0}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">filename</span><span class="p">[</span> <span class="p">:</span> <span class="o">-</span><span class="mi">4</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span> <span class="p">[</span> <span class="s">&#39;dot&#39;</span><span class="p">,</span> <span class="s">&#39;-Tpdf&#39;</span><span class="p">,</span> <span class="n">dot_filename</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">rendered_filename</span> <span class="p">],</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ WARNING ] only DOT file created, renderering with Graphviz failed.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.draw_heat_map_for_community_cluster"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.draw_heat_map_for_community_cluster">[docs]</a>    <span class="k">def</span> <span class="nf">draw_heat_map_for_community_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_folder</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">min_obCoFreq2plot</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">additional_labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]:</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">normalized_obCoFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">normalized_obCoFreq</span> <span class="o">&lt;</span> <span class="n">min_obCoFreq2plot</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span>
                <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
                <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
                <span class="n">additional_labels</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;{0:3.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">normalized_obCoFreq</span> <span class="p">)</span> <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;_placeholder_&#39;</span> <span class="p">)</span>
        <span class="n">hm_filename</span> <span class="o">=</span> <span class="s">&#39;{0}-{1}.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">],</span> <span class="n">name</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">sub_folder</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Working directory&#39;</span><span class="p">],</span> <span class="n">sub_folder</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">hm_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">sub_folder</span> <span class="p">,</span> <span class="n">hm_filename</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_map</span><span class="p">(</span>
            <span class="n">identifiers</span>       <span class="o">=</span> <span class="n">identifiers</span><span class="p">,</span>
            <span class="n">data</span>              <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">conditions</span>        <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">],</span>
            <span class="n">additional_labels</span> <span class="o">=</span> <span class="n">additional_labels</span><span class="p">,</span>
            <span class="n">minV</span>              <span class="o">=</span> <span class="n">minV</span><span class="p">,</span>
            <span class="n">maxV</span>              <span class="o">=</span> <span class="n">maxV</span><span class="p">,</span>
            <span class="n">heat_map_filename</span> <span class="o">=</span> <span class="n">hm_filename</span><span class="p">,</span>
            <span class="n">legend_filename</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">color_gradient</span>    <span class="o">=</span> <span class="n">color_gradient</span>
        <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.draw_community_heat_maps"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.draw_community_heat_maps">[docs]</a>    <span class="k">def</span> <span class="nf">draw_community_heat_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">close2root_size</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">close2root_size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">close2root_size</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="n">max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span> <span class="n">name</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_levelX_clusters</span><span class="p">(</span> <span class="n">level</span> <span class="o">=</span> <span class="n">max_level</span> <span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">max_level</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">close2root_size</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">additional_labels</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">]:</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span>
                    <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]:</span>
                        <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
                    <span class="n">additional_labels</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;{0:3.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;index 2 obCoFreq dict&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;_placeholder_&#39;</span> <span class="p">)</span>
            <span class="n">hm_filename</span> <span class="o">=</span> <span class="s">&#39;{0}-{1}.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">name</span> <span class="p">][</span> <span class="s">&#39;cluster ID&#39;</span> <span class="p">],</span> <span class="n">name</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_map</span><span class="p">(</span>
                <span class="n">identifiers</span>       <span class="o">=</span> <span class="n">identifiers</span><span class="p">,</span>
                <span class="n">data</span>              <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                <span class="n">conditions</span>        <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">],</span>
                <span class="n">additional_labels</span> <span class="o">=</span> <span class="n">additional_labels</span><span class="p">,</span>
                <span class="n">minV</span>              <span class="o">=</span> <span class="n">minV</span><span class="p">,</span>
                <span class="n">maxV</span>              <span class="o">=</span> <span class="n">maxV</span><span class="p">,</span>
                <span class="n">heat_map_filename</span> <span class="o">=</span> <span class="n">hm_filename</span><span class="p">,</span>
                <span class="n">legend_filename</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">color_gradient</span>    <span class="o">=</span> <span class="n">color_gradient</span>
            <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.draw_heat_map_for_cluster"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.draw_heat_map_for_cluster">[docs]</a>    <span class="k">def</span> <span class="nf">draw_heat_map_for_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusterID</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cluster</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">color_gradient</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="c"># check if function call was valid:</span>
        <span class="k">if</span> <span class="n">clusterID</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ ERROR ] call function &quot;draw_heat_map_for_cluster&quot; with either a clusterID or a cluster.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">clusterID</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;[ ERROR ] call function &quot;draw_heat_map_for_cluster&quot; with either a clusterID or a cluster.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">return</span>
        <span class="c"># if clusterID is given, get the corresponding cluster:</span>
        <span class="k">elif</span> <span class="n">clusterID</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cID</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cID</span> <span class="o">==</span> <span class="n">clusterID</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">c</span>

        <span class="c"># determine hm_filename:</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;{0}.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">hm_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="c"># prepare for drawing of heat map ...</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">additional_labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">cFreq</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">]</span>
            <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
            <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
            <span class="n">additional_labels</span><span class="p">[</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;{0:3.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">cFreq</span> <span class="p">)</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_map</span><span class="p">(</span>
            <span class="n">identifiers</span>       <span class="o">=</span> <span class="n">identifiers</span><span class="p">,</span>
            <span class="n">data</span>              <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">conditions</span>        <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">],</span>
            <span class="n">additional_labels</span> <span class="o">=</span> <span class="n">additional_labels</span><span class="p">,</span>
            <span class="n">minV</span>              <span class="o">=</span> <span class="n">minV</span><span class="p">,</span>
            <span class="n">maxV</span>              <span class="o">=</span> <span class="n">maxV</span><span class="p">,</span>
            <span class="n">heat_map_filename</span> <span class="o">=</span> <span class="n">hm_filename</span><span class="p">,</span>
            <span class="n">legend_filename</span>   <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
            <span class="n">color_gradient</span>    <span class="o">=</span> <span class="n">color_gradient</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;... heat map saved as &quot;{0}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">hm_filename</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.frequencies"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.frequencies">[docs]</a>    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cluster</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the frequencies for a given identifier (e.g. gene or FastaID)</span>
<span class="sd">        as dictionary or `None` if identifier is not part of the data set,</span>
<span class="sd">        index out of range or cluster was not found during iteration.</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; cluster.frequencies( identifier = &#39;jgi|Chlre4|513072|au5.g3286_t1&#39; )</span>
<span class="sd">        ... defaultdict(&lt;type &#39;float&#39;&gt;, {&#39;average-correlation&#39;: 0.0, &#39;complete-correlation&#39;: 0.0,</span>
<span class="sd">        ... &#39;centroid-euclidean&#39;: 0.0015, &#39;median-euclidean&#39;: 0.0064666666666666666,</span>
<span class="sd">        ... &#39;ward-euclidean&#39;: 0.0041333333333333335, &#39;weighted-correlation&#39;: 0.0,</span>
<span class="sd">        ... &#39;complete-euclidean&#39;: 0.0014, &#39;weighted-euclidean&#39;: 0.0066333333333333331,</span>
<span class="sd">        ... &#39;average-euclidean&#39;: 0.0020333333333333332})</span>

<span class="sd">        :param identifier: search frequencies by identifier input</span>
<span class="sd">        :type identifier: string</span>

<span class="sd">        :param index: search frequencies by cluster index input</span>
<span class="sd">        :type index: int</span>

<span class="sd">        :param cluster: search frequencies by cluster input</span>
<span class="sd">        :type cluster: tuple of ints</span>

<span class="sd">        :rtype: dict that contains the frequencies</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;invalid call of function &quot;frequencies&quot;: neither &quot;identifier&quot;, &quot;index&quot; nor &quot;cluster&quot; were given.</span><span class="se">\n\t</span><span class="s">returning None ...&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">cFreqDict</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">identifier</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># search by identifier</span>
            <span class="n">ident_index</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">clusterID</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ident_index</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]):</span>
                        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">clusterID</span> <span class="p">][</span> <span class="n">i</span> <span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span> <span class="p">)</span>
                        <span class="n">cFreqDict</span><span class="p">[</span> <span class="n">method</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">freq</span>
        <span class="k">elif</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">][</span> <span class="n">cluster</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dlc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span> <span class="p">]</span> <span class="p">):</span>
                <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">][</span> <span class="n">index</span> <span class="p">][</span> <span class="n">i</span> <span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span> <span class="p">)</span>
                <span class="n">cFreqDict</span><span class="p">[</span> <span class="n">dlc</span> <span class="p">]</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="n">distance_freqs</span> <span class="o">=</span> <span class="p">{</span> <span class="n">distance</span> <span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="p">}</span> <span class="c"># DAS WIRD MEGA OFT AUFGERUFEN -&gt; AUSLAGERN?!?</span>
        <span class="k">for</span> <span class="n">dlc</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cFreqDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">distance</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="n">dlc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)</span>
            <span class="n">distance_freqs</span><span class="p">[</span> <span class="n">distance</span> <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">cFreq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">median</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span> <span class="k">for</span> <span class="n">dist</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">distance_freqs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span>
</div>
<div class="viewcode-block" id="Cluster.plot_mean_distributions"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.plot_mean_distributions">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mean_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">rpy2.robjects</span> <span class="kn">as</span> <span class="nn">robjects</span>
        <span class="kn">from</span> <span class="nn">rpy2.robjects</span> <span class="kn">import</span> <span class="n">r</span>
        <span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span>
        <span class="n">graphics</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s">&#39;graphics&#39;</span><span class="p">)</span>
        <span class="n">grdevices</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s">&#39;grDevices&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">]</span> <span class="p">):</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;_slash_&#39;</span><span class="p">)</span>
            <span class="n">grdevices</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;folder&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s">&#39;Distribution_{0}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">))</span>
            <span class="n">graphics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                <span class="n">r</span><span class="o">.</span><span class="n">density</span><span class="p">(</span> <span class="n">robjects</span><span class="o">.</span><span class="n">FloatVector</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span><span class="p">[</span> <span class="n">n</span> <span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Mean_array&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="p">)),</span>
                                <span class="n">main</span> <span class="o">=</span> <span class="n">condition</span><span class="p">,</span>
                                <span class="n">col</span>  <span class="o">=</span> <span class="s">&#39;blue&#39;</span><span class="p">,</span>
                                <span class="n">xlab</span> <span class="o">=</span> <span class="s">&#39;Mean values&#39;</span><span class="p">,</span>
                                <span class="n">ylab</span> <span class="o">=</span> <span class="s">&#39;Density&#39;</span><span class="p">,</span>

            <span class="p">)</span>
            <span class="n">grdevices</span><span class="o">.</span><span class="n">dev_off</span><span class="p">()</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.draw_expression_profiles"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.draw_expression_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">draw_expression_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">maxV</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        description ...</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="n">FONT_SIZE</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">y_offset</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">MIN_V</span><span class="p">,</span> <span class="n">MAX_V</span> <span class="o">=</span> <span class="n">minV</span><span class="p">,</span> <span class="n">maxV</span>
        <span class="k">if</span> <span class="n">minV</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">maxV</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># determine min and max for y-axis:</span>
            <span class="n">_yAxisMinMax</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_mean_subarray</span><span class="p">,</span> <span class="n">_sd_subarray</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Mean_array&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;SD_array&#39;</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_mean_subarray</span><span class="p">,</span> <span class="n">_sd_subarray</span><span class="p">):</span>
                    <span class="n">_yAxisMinMax</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean</span> <span class="o">+</span> <span class="n">sd</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="n">_yAxisMinMax</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean</span> <span class="o">-</span> <span class="n">sd</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">minV</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">MIN_V</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">_yAxisMinMax</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">maxV</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">MAX_V</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_yAxisMinMax</span><span class="p">)))</span>
            <span class="c"># give y-axis the same amount in positive and negative direction (e.g. from - 10 to 10):</span>
            <span class="k">if</span> <span class="n">minV</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">maxV</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># but only if no value is given, otherwise it&#39;s probably user-chosen!</span>
                <span class="k">if</span> <span class="n">MAX_V</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">MIN_V</span><span class="p">):</span>
                    <span class="n">MIN_V</span> <span class="o">=</span> <span class="n">MAX_V</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">MAX_V</span> <span class="o">=</span> <span class="n">MIN_V</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">startingX</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">startingY</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">+</span> <span class="n">y_offset</span> <span class="c"># determine lenth of y-axis and y-range, represents zero point</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="p">(</span><span class="n">startingY</span> <span class="o">-</span> <span class="n">y_offset</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">scalingX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span> <span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="o">*</span> <span class="n">FONT_SIZE</span> <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">20</span> <span class="c"># distance between each condition</span>
        <span class="n">scalingY</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxY</span> <span class="o">-</span> <span class="p">(</span><span class="n">startingY</span> <span class="o">-</span> <span class="n">y_offset</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">MAX_V</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="c"># has to be negative!</span>

        <span class="k">def</span> <span class="nf">svg_text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&lt;text x=&quot;{0}&quot; y=&quot;{1}&quot;&gt; {2} &lt;/text&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&lt;line x1=&quot;{0}&quot; y1=&quot;{1}&quot; x2=&quot;{2}&quot; y2=&quot;{3}&quot; style=&quot;stroke:#000000&quot;/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">svg_comment</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&lt;!-- {0} --&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">min_max_ratioWithSD</span><span class="p">(</span><span class="n">ratios</span><span class="p">,</span> <span class="n">SDs</span><span class="p">):</span>
            <span class="n">ratios_plus_SD</span> <span class="o">=</span> <span class="p">[</span><span class="n">ratio</span> <span class="o">+</span> <span class="n">SDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ratios</span><span class="p">)]</span>
            <span class="n">ratios_minus_SD</span> <span class="o">=</span> <span class="p">[</span><span class="n">ratio</span> <span class="o">-</span> <span class="n">SDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ratios</span><span class="p">)]</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">ratios_minus_SD</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ratios_plus_SD</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">communityID</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Communities&#39;</span> <span class="p">][</span> <span class="n">communityID</span> <span class="p">][</span> <span class="s">&#39;indices&#39;</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">indices</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c"># ratios, SDs = self[&#39;Mean_array&#39;][indices], self[&#39;SD_array&#39;][indices]</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">shape</span> <span class="p">)</span>
            <span class="n">SDs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">shape</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">][</span> <span class="n">indices</span> <span class="p">]</span> <span class="p">):</span>
                <span class="k">for</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">]</span> <span class="p">)</span> <span class="p">):</span>
                    <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span>
                    <span class="n">ratios</span><span class="p">[</span> <span class="n">row_index</span> <span class="p">][</span> <span class="n">col_index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">mean</span>
                    <span class="n">SDs</span><span class="p">[</span> <span class="n">row_index</span> <span class="p">][</span> <span class="n">col_index</span> <span class="p">]</span> <span class="o">=</span> <span class="n">sd</span>

            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Identifiers&#39;</span><span class="p">][</span><span class="n">indices</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Additional Labels&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">addOn</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">addOn</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">][</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Identifiers&#39;</span><span class="p">][</span> <span class="n">index</span> <span class="p">]</span> <span class="p">]</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">addOn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">addOn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">set</span><span class="p">()):</span>
                            <span class="n">addOn</span> <span class="o">=</span> <span class="s">&quot;.oOo.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">addOn</span><span class="p">)))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;{0}___{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">addOn</span><span class="p">)</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">identifier</span> <span class="p">)</span>

            <span class="c">### draw expression profiles:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">,</span> <span class="s">&#39;exProf{0}.svg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">communityID</span><span class="p">)),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">startingX</span> <span class="o">+</span> <span class="n">scalingX</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">FONT_SIZE</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">FONT_SIZE</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; font-size=&quot;{2}px&quot; font-family=&quot;Verdana&quot; width=&quot;{0}&quot; height=&quot;{1}&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">maxY</span> <span class="o">+</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="n">FONT_SIZE</span><span class="p">,</span> <span class="n">FONT_SIZE</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c">## draw SD-cloud:</span>
                <span class="c"># determine min and max ratio + SD:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_comment</span><span class="p">(</span><span class="s">&#39;SD CLOUD:&#39;</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">y1_min</span><span class="p">,</span> <span class="n">y1_max</span> <span class="o">=</span> <span class="n">min_max_ratioWithSD</span><span class="p">(</span> <span class="p">[</span><span class="n">ratios</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratios</span><span class="p">))],</span> <span class="p">[</span><span class="n">SDs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SDs</span><span class="p">))]</span> <span class="p">)</span>
                    <span class="n">y2_min</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">=</span> <span class="n">min_max_ratioWithSD</span><span class="p">(</span> <span class="p">[</span><span class="n">ratios</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratios</span><span class="p">))],</span> <span class="p">[</span><span class="n">SDs</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SDs</span><span class="p">))]</span> <span class="p">)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&lt;path d=&quot;M{x1} {y1_min} L{x2} {y2_min} L{x2} {y2_max} L{x1} {y1_max} Z&quot; fill=&quot;{fill}&quot;/&gt;&#39;</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;fill&#39;</span> <span class="p">:</span> <span class="s">&#39;#D3D3D3&#39;</span><span class="p">}</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;x1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingX</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">scalingX</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;x2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingX</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">scalingX</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;y1_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">y1_min</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;y1_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">y1_max</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;y2_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">y2_min</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;y2_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">y2_max</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>

                <span class="c">## draw expression profile lines:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_comment</span><span class="p">(</span><span class="s">&#39;EXPRESSION PROFILE LINES:&#39;</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratios</span><span class="p">)):</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;x1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingX</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">scalingX</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;x2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingX</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">scalingX</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;y1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">ratios</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">scalingY</span>
                        <span class="n">d</span><span class="p">[</span><span class="s">&#39;y2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">ratios</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">scalingY</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;x1&#39;</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;y1&#39;</span><span class="p">],</span> <span class="n">x2</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;x2&#39;</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;y2&#39;</span><span class="p">]),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>

                <span class="c">## add legend:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_comment</span><span class="p">(</span><span class="s">&#39;LEGEND:&#39;</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c"># first, collect all values to plot -&gt; to allow removing overlapping identifiers:</span>
                <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">identifiers</span><span class="p">):</span>
                    <span class="n">_last_ratio</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">startingX</span> <span class="o">+</span> <span class="n">scalingX</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="n">_y</span> <span class="o">=</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">_last_ratio</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="n">legend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">legend</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="c"># get all y-differences:</span>
                <span class="n">y_differences</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">legend</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">y_differences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">legend</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span> <span class="p">)</span>
                <span class="c"># max font size for legend is the minimum y distance -&gt; no overlap!</span>
                <span class="n">legend_maxFontSize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_differences</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">legend_maxFontSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">legend_maxFontSize</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c"># plot legend</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;text x=&quot;{0}&quot; y=&quot;{1}&quot; font-size=&quot;{3}px&quot;&gt;{2}&lt;/text&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">legend_maxFontSize</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>

                <span class="c">## plot axis:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_comment</span><span class="p">(</span><span class="s">&#39;AXES:&#39;</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c"># y-axis:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">startingY</span> <span class="o">+</span> <span class="n">MAX_V</span><span class="o">*</span><span class="n">scalingY</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">maxY</span> <span class="o">+</span> <span class="n">y_offset</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c"># y-axis - ticks:</span>
                <span class="n">y_ticks_per_unit</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_V</span> <span class="o">*</span> <span class="n">y_ticks_per_unit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_ticks_per_unit</span>
                    <span class="n">_y</span> <span class="o">=</span>  <span class="n">startingY</span> <span class="o">+</span> <span class="n">_ratio</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">svg_text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">_y</span> <span class="o">+</span> <span class="n">FONT_SIZE</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#39;+{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_ratio</span><span class="p">)),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">_y</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">_y</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">MIN_V</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_ticks_per_unit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_ticks_per_unit</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">_y</span> <span class="o">=</span>  <span class="n">startingY</span> <span class="o">+</span> <span class="n">_ratio</span><span class="o">*</span><span class="n">scalingY</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">svg_text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">_y</span> <span class="o">+</span> <span class="n">FONT_SIZE</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">_ratio</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">_y</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">_y</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">startingY</span> <span class="o">+</span> <span class="n">FONT_SIZE</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">startingY</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">startingY</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c"># zero-line:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">svg_line</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">startingY</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="n">startingX</span> <span class="o">+</span> <span class="n">scalingX</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">y2</span><span class="o">=</span><span class="n">startingY</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                <span class="c"># x-axis = conditions:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">]):</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">startingX</span> <span class="o">+</span> <span class="n">scalingX</span><span class="o">*</span><span class="n">i</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">svg_text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">_x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">maxY</span> <span class="o">+</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="n">FONT_SIZE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">condition</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;line x1=&quot;{0}&quot; y1=&quot;{1}&quot; x2=&quot;{2}&quot; y2=&quot;{3}&quot; style=&quot;stroke-dasharray: 5, 5; stroke:#000000&quot;/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">startingY</span> <span class="o">+</span> <span class="n">MAX_V</span><span class="o">*</span><span class="n">scalingY</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="n">maxY</span> <span class="o">+</span> <span class="n">y_offset</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>

                <span class="k">print</span><span class="p">(</span><span class="s">&#39;&lt;/svg&gt;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;... expression profiles saved in &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.do_it_all"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.do_it_all">[docs]</a>    <span class="k">def</span> <span class="nf">do_it_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict_user</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        e.g. call with:</span>
<span class="sd">        ClusterClass.do_it_all( {&#39;iterations&#39;:10, &#39;pickle_filename&#39;:False, &#39;cpu&#39;:2, &#39;working_dir&#39;:&#39;/Users/daniel/tmp&#39;} )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">param_dict_user</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">param_dict_user</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;working_dir&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;folder&#39;</span><span class="p">]</span>

        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;methods&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="p">[</span><span class="s">&#39;complete&#39;</span><span class="p">,</span> <span class="s">&#39;average&#39;</span><span class="p">,</span> <span class="s">&#39;weighted&#39;</span><span class="p">,</span> <span class="s">&#39;centroid&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">,</span> <span class="s">&#39;ward&#39;</span> <span class="p">,</span> <span class="s">&#39;single&#39;</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;metrics&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="p">[</span><span class="s">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s">&#39;correlation&#39;</span><span class="p">]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_max&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="mi">250000</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_tol&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="mi">100000</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_step&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="mi">5000</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_topP&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_window&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="mi">50000</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;force_plotting&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="bp">False</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minSize_resampling&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">4</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minFrequ_resampling&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;pickle_filename&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="s">&#39;MERGED_pyGCluster.pkl&#39;</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;cpu&#39;</span><span class="p">]</span>                   <span class="o">=</span> <span class="bp">None</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_till_the_end&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">False</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minSize_plotting&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">4</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minFrequ_plotting&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;topXcluster_plotting&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;colorScheme&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="s">&#39;Daniel&#39;</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_min&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="bp">None</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_max&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="bp">None</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_pathDiff&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">False</span>
        <span class="n">param_dict</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">]</span>   <span class="o">=</span> <span class="bp">None</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;discare 1-count clusters threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">param_dict_user</span> <span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;discare 1-count clusters threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;discare 1-count clusters threshold&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;working_dir&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;verbose&#39;</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">resampling ...&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span>
                        <span class="n">distances</span>             <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;metrics&#39;</span><span class="p">],</span>
                        <span class="n">linkages</span>              <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;methods&#39;</span><span class="p">],</span>
                        <span class="n">iter_max</span>              <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_max&#39;</span><span class="p">],</span>
                        <span class="n">iter_topP</span>             <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_topP&#39;</span><span class="p">],</span>
                        <span class="n">iter_step</span>             <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_step&#39;</span><span class="p">],</span>
                        <span class="n">iter_tol</span>              <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_tol&#39;</span><span class="p">],</span>
                        <span class="n">iter_window</span>           <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_window&#39;</span><span class="p">],</span>
                        <span class="n">minClusterSize</span>        <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minSize_resampling&#39;</span><span class="p">],</span>
                        <span class="n">minClusterFreq2retain</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minFrequ_resampling&#39;</span><span class="p">],</span>
                        <span class="n">pickle_filename</span>       <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;pickle_filename&#39;</span><span class="p">],</span>
                        <span class="n">CPUs2use</span>              <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;cpu&#39;</span><span class="p">],</span>
                        <span class="n">force_plotting</span>        <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;force_plotting&#39;</span><span class="p">],</span>
                        <span class="n">iter_till_the_end</span>     <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;iter_till_the_end&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;verbose&#39;</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;resampling done.&#39;</span><span class="p">)</span>

        <span class="c"># pickle merged class:</span>
        <span class="c"># self.save(&#39;MERGED_{0}iter_max.pkl&#39;.format(param_dict[&#39;iter_max&#39;]))</span>
        <span class="c"># print(&#39;\nmerged clustering class is saved as: &#39;, os.path.join(param_dict[&#39;working_dir&#39;], &#39;MERGED_{0}iter_max.pkl&#39;.format(param_dict[&#39;iter_max&#39;])))</span>

        <span class="c"># plotting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;verbose&#39;</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">plotting barplot, building nodemap, drawing heatmaps ...&#39;</span><span class="p">)</span>
        <span class="n">minClusterSize</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minSize_plotting&#39;</span><span class="p">]</span>
        <span class="n">topP</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;minFrequ_plotting&#39;</span><span class="p">]</span>
        <span class="n">topX</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;topXcluster_plotting&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_clusterfreqs</span><span class="p">(</span>
                                <span class="n">minClusterSize</span> <span class="o">=</span> <span class="n">minClusterSize</span><span class="p">,</span>
                                <span class="n">topX</span>           <span class="o">=</span> <span class="n">topX</span><span class="p">,</span>
                                <span class="n">topP</span>           <span class="o">=</span> <span class="n">topP</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_nodemap</span><span class="p">(</span>
                                <span class="n">minClusterSize</span> <span class="o">=</span> <span class="n">minClusterSize</span><span class="p">,</span>
                                <span class="n">topX</span>           <span class="o">=</span> <span class="n">topX</span><span class="p">,</span>
                                <span class="n">topP</span>           <span class="o">=</span> <span class="n">topP</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_dot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_heat_maps</span><span class="p">(</span>
                                <span class="n">minV</span>                <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_min&#39;</span><span class="p">],</span>
                                <span class="n">maxV</span>                <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_max&#39;</span><span class="p">],</span>
                                <span class="n">showPathDiffference</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_pathDiff&#39;</span><span class="p">],</span>
                                <span class="n">colorScheme</span>         <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;colorScheme&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_expression_profiles</span><span class="p">(</span>
                                <span class="n">minV</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_min&#39;</span><span class="p">],</span>
                                <span class="n">maxV</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s">&#39;heatmap_max&#39;</span><span class="p">]</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="Cluster.ubiGraphism"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.ubiGraphism">[docs]</a>    <span class="k">def</span> <span class="nf">ubiGraphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapedetail</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        NOT UPDATED TO WORK WITH FUNCTION &#39;combineClusterApproaches&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">ubigraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_nodemap</span><span class="p">()</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rainbow_colors</span><span class="p">(</span> <span class="n">nColors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">]))</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">ubigraph</span><span class="o">.</span><span class="n">Ubigraph</span><span class="p">()</span>
        <span class="n">U</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">Nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">maxFreq</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_max_frequency</span><span class="p">(</span> <span class="n">maxClusterSizeToInclude</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">MIN_NODE_SIZE</span> <span class="o">=</span> <span class="mf">2.1</span>
        <span class="n">MAX_NODE_SIZE</span> <span class="o">=</span> <span class="mf">7.7</span>
        <span class="n">root</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Identifiers&#39;</span><span class="p">])))</span>
        <span class="n">rootSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">rootID</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;ClusterIDs&#39;</span><span class="p">][</span><span class="n">root</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">community_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">][</span><span class="n">community_id</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
                <span class="n">nodeID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodemap_cluster2nodeID</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nodeID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span> <span class="c"># clusters was created during formation of the cluster-tree, not found by resampling</span>
                    <span class="n">cFreqDict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">method</span> <span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Methods&#39;</span><span class="p">]</span> <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cFreq</span><span class="p">,</span> <span class="n">cFreqDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="c"># if max(cFreqDict.values()) &lt;= 0.02:</span>
                <span class="c">#     continue</span>
                <span class="n">lenOfCluster</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">cluster</span> <span class="p">)</span>
                <span class="c"># 2) community_id</span>
                <span class="c"># toBcolored =</span>
                <span class="c"># cself[&#39;Nodemap id2cluster&#39;][ clusterID ]</span>
                <span class="n">nodeSize</span> <span class="o">=</span> <span class="n">MIN_NODE_SIZE</span> <span class="o">+</span> <span class="p">(</span><span class="n">MAX_NODE_SIZE</span> <span class="o">-</span> <span class="n">MIN_NODE_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cFreqDict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="n">maxFreq</span>
                <span class="k">if</span> <span class="n">nodeSize</span> <span class="o">&gt;</span> <span class="n">MAX_NODE_SIZE</span><span class="p">:</span>
                    <span class="n">nodeSize</span> <span class="o">=</span> <span class="n">MAX_NODE_SIZE</span>
                <span class="k">elif</span> <span class="n">nodeSize</span> <span class="o">&lt;</span> <span class="n">MIN_NODE_SIZE</span><span class="p">:</span>
                    <span class="n">nodeSize</span> <span class="o">=</span> <span class="n">MIN_NODE_SIZE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># everything is alright with the size :) yea!</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">lenOfCluster</span> <span class="o">&gt;=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">rootSize</span><span class="p">:</span>
                    <span class="n">shape</span>  <span class="o">=</span> <span class="s">&#39;torus&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="s">&#39;sphere&#39;</span>
                <span class="c"># if clusterID == rootID:</span>
                <span class="c">#     shape = &#39;dodecahedron&#39;</span>
                <span class="c">#     nodeSize = 1.2 * MAX_NODE_SIZE</span>
                <span class="c">#     color = &#39;#FFFFFF&#39;</span>
                <span class="c"># else:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span> <span class="n">community_id</span> <span class="p">]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Color: {0}, shape: {1}, nodeSize: {2}, maxFreq: {3}, sumFreq: {4}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">nodeSize</span><span class="p">,</span> <span class="n">maxFreq</span> <span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cFreqDict</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
                <span class="n">Nodes</span><span class="p">[</span> <span class="n">nodeID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">newVertex</span><span class="p">(</span>
                                                        <span class="n">shape</span>       <span class="o">=</span> <span class="n">shape</span><span class="p">,</span>
                                                        <span class="n">color</span>       <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
                                                        <span class="n">size</span>        <span class="o">=</span> <span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">nodeSize</span> <span class="p">),</span>
                                                        <span class="n">label</span>       <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">nodeID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span>
                                                        <span class="n">shapedetail</span> <span class="o">=</span> <span class="n">shapedetail</span>
                                            <span class="p">)</span>

        <span class="c"># add root node:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="s">&#39;dodecahedron&#39;</span>
        <span class="n">nodeSize</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">MAX_NODE_SIZE</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#FFFFFF&#39;</span>
        <span class="n">Nodes</span><span class="p">[</span> <span class="n">rootID</span> <span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">newVertex</span><span class="p">(</span>
                                                <span class="n">shape</span>       <span class="o">=</span> <span class="n">shape</span><span class="p">,</span>
                                                <span class="n">color</span>       <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
                                                <span class="n">size</span>        <span class="o">=</span> <span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">nodeSize</span> <span class="p">),</span>
                                                <span class="n">label</span>       <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">rootID</span> <span class="p">),</span>
                                                <span class="n">shapedetail</span> <span class="o">=</span> <span class="n">shapedetail</span>
                                    <span class="p">)</span>


        <span class="n">Edges</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">getTheInput</span> <span class="o">=</span> <span class="nb">input</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getTheInput</span> <span class="o">=</span> <span class="nb">raw_input</span>
        <span class="n">getTheInput</span><span class="p">(</span><span class="s">&#39;press return to start drawing edges ...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">community_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">][</span><span class="n">community_id</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span> <span class="c">#for clusterID in clusterIDs:</span>
                <span class="n">parentID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodemap_cluster2nodeID</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                <span class="c"># childrenIDs = self[&#39;Nodemap&#39;][ clusterID ][&#39;children&#39;]</span>
                <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Nodemap&#39;</span><span class="p">][</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="p">]:</span>
                <span class="c"># for childID, intersectionType in childrenIDs:</span>
                    <span class="c">#           ^- [ &#39;s&#39; (subset) o. &#39;i&#39; (intersection) ]</span>
                    <span class="c"># if clusterID in Nodes.keys() and childID in Nodes.keys(): # wird dieser &#39;if-satz&#39; jemals &#39;False&#39; ???</span>
                    <span class="n">childID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodemap_cluster2nodeID</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="n">parentID</span><span class="p">,</span> <span class="n">childID</span> <span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Edges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">Edges</span><span class="p">[</span> <span class="p">(</span> <span class="n">parentID</span><span class="p">,</span> <span class="n">childID</span> <span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">newEdge</span><span class="p">(</span>
                                                                <span class="n">Nodes</span><span class="p">[</span> <span class="n">parentID</span> <span class="p">],</span>
                                                                <span class="n">Nodes</span><span class="p">[</span> <span class="n">childID</span> <span class="p">],</span>
                                                                <span class="n">arrow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                <span class="n">arrow_radius</span><span class="o">=</span> <span class="s">&#39;1.&#39;</span><span class="p">,</span>
                                                                <span class="n">spline</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
                                                                <span class="n">color</span>  <span class="o">=</span> <span class="s">&#39;#CCCCCC&#39;</span><span class="p">,</span><span class="c"># &#39;#00ff00&#39; if intersectionType == &#39;s&#39; else &#39;#ff0000&#39;,</span>
                                                                <span class="n">width</span> <span class="o">=</span> <span class="s">&#39;2.0&#39;</span>
                                                        <span class="p">)</span>

        <span class="c">## add connection to root node:</span>
        <span class="k">for</span> <span class="n">communityID</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Communities&#39;</span><span class="p">][</span><span class="n">communityID</span><span class="p">][</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
            <span class="n">largest</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster</span><span class="p">),</span> <span class="n">tag</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span> <span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span><span class="n">largest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">largest</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">largest</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">childID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodemap_cluster2nodeID</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="n">Edges</span><span class="p">[</span> <span class="p">(</span> <span class="n">rootID</span><span class="p">,</span> <span class="n">childID</span> <span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">newEdge</span><span class="p">(</span>
                                                    <span class="n">Nodes</span><span class="p">[</span> <span class="n">rootID</span> <span class="p">],</span>
                                                    <span class="n">Nodes</span><span class="p">[</span> <span class="n">childID</span> <span class="p">],</span>
                                                    <span class="n">arrow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                    <span class="n">arrow_radius</span><span class="o">=</span> <span class="s">&#39;1.&#39;</span><span class="p">,</span>
                                                    <span class="n">spline</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
                                                    <span class="n">color</span>  <span class="o">=</span> <span class="s">&#39;#CCCCCC&#39;</span><span class="p">,</span><span class="c"># &#39;#00ff00&#39; if intersectionType == &#39;s&#39; else &#39;#ff0000&#39;,</span>
                                                    <span class="n">width</span> <span class="o">=</span> <span class="s">&#39;2.0&#39;</span>
                                            <span class="p">)</span>
</div>
<div class="viewcode-block" id="Cluster.info"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prints some information about the cluster</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">            {0:&gt;9} identifiers were used to cluster</span>
<span class="s">            {1:&gt;9} conditions were defined</span>
<span class="s">            {2:&gt;9} linkage - distance def combos were used</span>
<span class="s">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Identifiers&#39;</span><span class="p">]),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Conditions&#39;</span><span class="p">]),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;resampling&#39;</span><span class="p">][</span><span class="s">&#39;minClusterFreq2retain&#39;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Pcounter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;{0:&gt;30}, resample counter {1:&lt;9}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Cluster.save"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;MERGED_pyGCluster.pkl&#39;</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tmp</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">),</span> <span class="s">&#39;wb&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">fout</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;pyGCluster pickled in: &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">)</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">fout</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;pyGCluster pickled in: &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">filename</span> <span class="p">),</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.load"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span> <span class="n">filename</span> <span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">fin</span> <span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;Params&#39;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">tmp</span><span class="p">[</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;folder&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Params&#39;</span><span class="p">][</span><span class="s">&#39;folder&#39;</span><span class="p">],</span> <span class="n">filename</span> <span class="p">),</span> <span class="s">&#39;rb&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">fin</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">filename</span> <span class="p">),</span> <span class="s">&#39;rb&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">fin</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;ClusterIDs&#39;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_old2new</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&#39;Root size&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;Root&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Root size&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;Cluster 2 rowindex in self-clustercounts&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Cluster 2 rowindex in self-clustercounts&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;Cluster 2 rowindex in self-clustercounts&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;pyGCluster loaded.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="Cluster.convert_old2new"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.convert_old2new">[docs]</a>    <span class="k">def</span> <span class="nf">convert_old2new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        converts old to new pyGCluster.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># convert basic stuff:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;verbose&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Verbosity level&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Version&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;version&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;version&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Params&#39;</span> <span class="p">][</span> <span class="s">&#39;folder&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Params&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Additional Labels&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;additionalLabels&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;additionalLabels&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;intconvbase&#39;</span> <span class="p">]</span>

        <span class="c"># convert re-sampling specific stuff:</span>
        <span class="n">dlc</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">linkages</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Methods&#39;</span> <span class="p">]:</span>
            <span class="n">linkage</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;-&#39;</span> <span class="p">)</span>
            <span class="n">dlc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;{0}-{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">distance</span><span class="p">,</span> <span class="n">linkage</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">distances</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">distance</span> <span class="p">)</span>
            <span class="n">linkages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">linkage</span> <span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distance-linkage combinations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dlc</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Methods&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Linkages&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">linkages</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Distances&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">distances</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Pcounter&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Iterations&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Pcounter&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Pcounter&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_step&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_step&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_max&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_max&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_topP&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_topP&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_tol&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_tol&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - params&#39;</span> <span class="p">][</span> <span class="s">&#39;iter_window&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - first detected at iteration&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">][</span> <span class="s">&#39;firstConvergedAtIter&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting_params&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Convergence determination - iteration 2 n_mostfreq&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;TMP_plotting&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster 2 clusterID&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;ClusterIDs&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;ClusterIDs&#39;</span> <span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Cluster counts&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span>
        <span class="c"># fill class with the data which was clustered:</span>
        <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Identifiers&#39;</span> <span class="p">]</span> <span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Conditions&#39;</span> <span class="p">]</span> <span class="p">):</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Mean_array&#39;</span> <span class="p">][</span> <span class="n">row_index</span> <span class="p">][</span> <span class="n">col_index</span> <span class="p">]</span>
                <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;SD_array&#39;</span> <span class="p">][</span> <span class="n">row_index</span> <span class="p">][</span> <span class="n">col_index</span> <span class="p">]</span>
                <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">][</span> <span class="n">identifier</span> <span class="p">][</span> <span class="n">condition</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sd</span> <span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Mean_array&#39;</span> <span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;SD_array&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span> <span class="s">&#39;old pyGCluster successfully converted to new pyGCluster.&#39;</span><span class="p">,</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="s">&#39;MERGED_pyGCluster.pkl&#39;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
    <span class="k">def</span> <span class="nf">_baseXstring2int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        string, alphabet</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">string</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">_int</span> <span class="o">+=</span> <span class="n">alphabet</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">_int</span>

<div class="viewcode-block" id="Cluster.median"><a class="viewcode-back" href="../pyGCluster.html#pyGCluster.Cluster.median">[docs]</a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_list</span><span class="p">):</span>
        <span class="n">_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_list</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">length</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">_list</span><span class="p">[</span><span class="n">length</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">_list</span><span class="p">[</span><span class="n">length</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">_list</span><span class="p">[</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span> <span class="s">&#39;verbosity_level&#39;</span> <span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="p">[</span> <span class="s">&#39;Verbosity level&#39;</span> <span class="p">]:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span> <span class="s">&#39;verbosity_level&#39;</span> <span class="p">]</span>
            <span class="k">print</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">return</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
    <span class="c"># test communities:</span>
    <span class="c"># s = &#39;/media/plan-f/Shared/Documents/OwnPublications/2013.1_Barth_ROS/Cluster_ROS_TechAOnly_iW_pT_EstimatedMissingRatioFromPathDiff_1000KIterations_NEWIdents_23042013/MERGED_pyGCluster.pkl&#39;</span>
    <span class="c"># s = &#39;/media/plan-f/Shared/Users/daniel/tmp/synData/noiseMean0.2_noiseSD0.8_ABSOLUTE/MERGED.pkl&#39;</span>
    <span class="c"># s = &#39;/media/plan-f/Shared/Documents/OwnPublications/2012.1 Hoehner et al./Cluster_All_new_HeatMaps/MERGED_pyGCluster.pkl&#39;</span>
    <span class="c"># # s = &#39;/Users/fu/Documents/_science/_Publications_/2013.1_Barth et al. ROS Power/Clusters/Cluster_ROS_TechAOnly_iW_pT_EstimatedMissingRatioFromPathDiff_1000KIterations_NEWIdents_23042013/MERGED_pyGCluster.pkl&#39;</span>
    <span class="c"># # s = &#39;/Users/fu/Documents/_science/_Publications_/2013.1_Barth et al. ROS Power/Clusters/Cluster_ROS_TechAOnly_iW_pT_EstimatedMissingRatioFromPathDiff_1000KIterations_NEWIdents_08052013/MERGED_pyGCluster.pkl&#39;</span>
    <span class="c"># # s = &#39;/Users/fu/Documents/_science/_Publications_/2013.1_Barth et al. ROS Power/Clusters/Cluster_ROS_TechAOnly_NoMAB_iW_pT_EstimatedMissingRatioFromPathDiff_1000KIterations_NEWIdents_08052013/MERGED_pyGCluster.pkl&#39;</span>
    <span class="c"># x.load( s )</span>
    <span class="c"># x[ &#39;Working directory&#39; ] = &#39;/Users/daniel/tmp/ricardsa&#39; #os.path.dirname( s )</span>
    <span class="c"># x.plot_clusterfreqs()</span>
    <span class="c"># x.build_nodemap( )</span>
    <span class="c"># x.write_dot( filename= &#39;dotty.dot&#39;, min_obCoFreq2plot = None, minV = -3, maxV = 3, color_gradient = &#39;1337_2&#39;, scaleByFreq  = False )</span>
    <span class="c"># x.draw_community_heat_maps()</span>
    <span class="c"># exit()</span>

    <span class="c"># test re-sampling ...</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="s">&#39;/media/plan-f/Shared/Users/daniel/tmp/ROS2nd/MERGED_pyGCluster.pkl&#39;</span> <span class="p">)</span>
    <span class="n">ROS2nd</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span> <span class="s">&#39;Data&#39;</span> <span class="p">],</span> <span class="n">working_directory</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span> <span class="s">&#39;Working directory&#39;</span> <span class="p">],</span> <span class="n">verbosity_level</span> <span class="o">=</span> <span class="mi">99</span> <span class="p">)</span> <span class="c"># because of OrderedDict() !!!</span>
    <span class="n">ROS2nd</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s">&#39;correlation&#39;</span><span class="p">],</span> <span class="n">linkages</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;complete&#39;</span><span class="p">,</span> <span class="s">&#39;average&#39;</span><span class="p">,</span> <span class="s">&#39;weighted&#39;</span><span class="p">,</span> <span class="s">&#39;centroid&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">,</span> <span class="s">&#39;ward&#39;</span><span class="p">],</span> <span class="n">CPUs2use</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">iter_till_the_end</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">iter_max</span> <span class="o">=</span> <span class="mi">390000</span><span class="p">,</span> <span class="n">pickle_filename</span> <span class="o">=</span> <span class="s">&#39;TMP_NEW_VERSION_WORKING.pkl&#39;</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pyGCluster 0.18.4 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Daniel Jaeger, Johannes Barth, Anna Niehues and Christian Fufezan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>